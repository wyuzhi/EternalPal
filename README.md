# EternalPal - 抖音小程序3D宠物陪伴系统

## 项目概述

EternalPal（永恒伙伴）是一款基于抖音小程序平台开发的3D宠物陪伴应用，让用户可以拥有个性化的虚拟宠物，并与之进行实时互动和聊天。

## 项目结构

项目采用前后端分离架构，前端为抖音小程序，后端为Python服务。整体目录结构如下：

```
EternalPal/
├── app.js            # 小程序入口文件
├── app.json          # 小程序全局配置
├── app.ttss          # 小程序全局样式
├── backend/          # 后端Python服务
│   ├── app.py        # 后端API入口
│   ├── chat.py       # 聊天功能实现
│   ├── generate_3d_model.py # 3D模型生成相关
│   ├── models/       # 存储生成的3D模型
│   └── requirements.txt # Python依赖
├── images/           # 小程序图片资源
│   ├── hobby/        # 宠物爱好相关图标
│   └── personality/  # 宠物性格相关图标
├── miniprogram_npm/  # 小程序依赖包
│   ├── @douyin-microapp/ # 抖音官方组件
│   └── three/        # Three.js库
├── pages/            # 小程序页面
│   ├── companion/    # 宠物陪伴页面（核心功能）
│   ├── index/        # 首页
│   └── pet/          # 宠物管理页面
├── project.config.json # 小程序项目配置
└── project.private.config.json # 小程序私有配置
```

## 核心功能

### 1. 3D宠物展示

基于抖音小程序AR-Three.js库实现的3D宠物模型渲染，支持以下功能：
- 加载和渲染自定义3D OBJ模型
- 模型自动旋转展示
- 触摸交互控制模型旋转
- 自动降级机制（3D渲染失败时切换为图片显示）

### 2. 智能聊天交互

实现了用户与虚拟宠物的实时聊天功能：
- 文本消息发送与接收
- 快捷回复功能
- 聊天记录保存与加载
- 宠物心情状态展示

### 3. 宠物个性化

支持多种宠物类型和个性化设置：
- 不同类型的宠物模型
- 宠物性格特征设置
- 宠物爱好选择

## 技术实现

### 前端技术栈

- 抖音小程序开发框架
- Three.js（通过microapp-ar-three适配）
- 抖音小程序AR-Three.js组件库

### 后端技术栈

- Python Flask/Django
- 3D模型生成算法
- 数据库存储

## 关键模块详解

### ModelRenderer 类

位于`pages/companion/ModelRenderer.js`，是项目核心的3D渲染控制器，负责：
- 初始化3D渲染环境（适配抖音小程序）
- 加载和渲染3D模型
- 处理模型交互事件
- 管理渲染资源生命周期

### 宠物陪伴页面

位于`pages/companion/companion.js`，实现了完整的用户交互界面：
- 宠物信息展示
- 聊天界面
- 3D模型交互区域
- 快捷功能菜单

## 开发指南

### 前置条件

- 抖音开发者工具
- Node.js环境
- Python环境（用于后端开发）

### 安装步骤

1. 克隆项目代码

2. 安装前端依赖：
```bash
npm install
```

3. 构建npm包：
```bash
# 在抖音开发者工具中点击"构建npm"
```

4. 安装后端依赖：
```bash
cd backend
pip install -r requirements.txt
```

### 配置说明

1. 小程序配置：修改`project.config.json`和`app.json`中的相关配置

2. 后端API配置：确保前端代码中的`app.globalData.API_BASE_URL`指向正确的后端服务地址

### 开发流程

1. 使用抖音开发者工具打开项目

2. 运行前端开发服务器

3. 启动后端服务：
```bash
cd backend
python app.py
```

4. 在开发者工具中预览和调试小程序

## 常见问题与解决方案

### 1. 3D模型加载失败

**问题描述**：小程序无法加载或显示3D模型

**解决方案**：
- 确认模型URL是否正确且可访问
- 检查是否已配置网络请求白名单
- 确认microapp-ar-three库已正确安装
- 如问题持续，系统会自动切换到图片模式

### 2. 聊天功能异常

**问题描述**：无法发送消息或接收回复

**解决方案**：
- 检查网络连接是否正常
- 确认后端服务是否运行
- 验证宠物ID是否正确

### 3. 性能优化建议

- 对于大型3D模型，建议适当降低模型复杂度
- 在不需要3D渲染时，使用图片模式以节省资源
- 避免在低端设备上频繁切换3D和图片模式

## 项目特色

1. **高度适配抖音小程序环境**：针对小程序特性进行了全面优化

2. **完善的错误处理机制**：多层级错误捕获和优雅降级

3. **优秀的用户体验**：流畅的3D渲染和自然的交互设计

4. **模块化架构**：前后端分离，代码结构清晰，便于维护和扩展

## 注意事项

1. 本项目使用的`@douyin-microapp/microapp-ar-three`库需要在抖音小程序环境中运行

2. 3D模型渲染可能在部分低端设备上性能受限

3. 请遵守抖音小程序开发规范和相关法律法规

## License

[MIT License](https://opensource.org/licenses/MIT)

## 致谢

感谢抖音开放平台提供的技术支持，以及所有为项目做出贡献的开发者。