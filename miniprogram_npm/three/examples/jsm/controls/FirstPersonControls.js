import{Controls,MathUtils,Spherical,Vector3}from"three";const _lookDirection=new Vector3,_spherical=new Spherical,_target=new Vector3,_targetPosition=new Vector3;class FirstPersonControls extends Controls{constructor(t,e=null){super(t,e),this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this._autoSpeedFactor=0,this._pointerX=0,this._pointerY=0,this._moveForward=!1,this._moveBackward=!1,this._moveLeft=!1,this._moveRight=!1,this._viewHalfX=0,this._viewHalfY=0,this._lat=0,this._lon=0,this._onPointerMove=onPointerMove.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerUp=onPointerUp.bind(this),this._onContextMenu=onContextMenu.bind(this),this._onKeyDown=onKeyDown.bind(this),this._onKeyUp=onKeyUp.bind(this),null!==e&&(this.connect(e),this.handleResize()),this._setOrientation()}connect(t){super.connect(t),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerMove),this.domElement.removeEventListener("pointermove",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}handleResize(){this.domElement===document?(this._viewHalfX=window.innerWidth/2,this._viewHalfY=window.innerHeight/2):(this._viewHalfX=this.domElement.offsetWidth/2,this._viewHalfY=this.domElement.offsetHeight/2)}lookAt(t,e,i){return t.isVector3?_target.copy(t):_target.set(t,e,i),this.object.lookAt(_target),this._setOrientation(),this}update(t){if(!1===this.enabled)return;if(this.heightSpeed){const e=MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this._autoSpeedFactor=t*(e*this.heightCoef)}else this._autoSpeedFactor=0;const e=t*this.movementSpeed;(this._moveForward||this.autoForward&&!this._moveBackward)&&this.object.translateZ(-(e+this._autoSpeedFactor)),this._moveBackward&&this.object.translateZ(e),this._moveLeft&&this.object.translateX(-e),this._moveRight&&this.object.translateX(e),this._moveUp&&this.object.translateY(e),this._moveDown&&this.object.translateY(-e);let i=t*this.lookSpeed;this.activeLook||(i=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this._lon-=this._pointerX*i,this.lookVertical&&(this._lat-=this._pointerY*i*o),this._lat=Math.max(-85,Math.min(85,this._lat));let s=MathUtils.degToRad(90-this._lat);const n=MathUtils.degToRad(this._lon);this.constrainVertical&&(s=MathUtils.mapLinear(s,0,Math.PI,this.verticalMin,this.verticalMax));const h=this.object.position;_targetPosition.setFromSphericalCoords(1,s,n).add(h),this.object.lookAt(_targetPosition)}_setOrientation(){const t=this.object.quaternion;_lookDirection.set(0,0,-1).applyQuaternion(t),_spherical.setFromVector3(_lookDirection),this._lat=90-MathUtils.radToDeg(_spherical.phi),this._lon=MathUtils.radToDeg(_spherical.theta)}}function onPointerDown(t){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(t.button){case 0:this._moveForward=!0;break;case 2:this._moveBackward=!0}this.mouseDragOn=!0}function onPointerUp(t){if(this.activeLook)switch(t.button){case 0:this._moveForward=!1;break;case 2:this._moveBackward=!1}this.mouseDragOn=!1}function onPointerMove(t){this.domElement===document?(this._pointerX=t.pageX-this._viewHalfX,this._pointerY=t.pageY-this._viewHalfY):(this._pointerX=t.pageX-this.domElement.offsetLeft-this._viewHalfX,this._pointerY=t.pageY-this.domElement.offsetTop-this._viewHalfY)}function onKeyDown(t){switch(t.code){case"ArrowUp":case"KeyW":this._moveForward=!0;break;case"ArrowLeft":case"KeyA":this._moveLeft=!0;break;case"ArrowDown":case"KeyS":this._moveBackward=!0;break;case"ArrowRight":case"KeyD":this._moveRight=!0;break;case"KeyR":this._moveUp=!0;break;case"KeyF":this._moveDown=!0}}function onKeyUp(t){switch(t.code){case"ArrowUp":case"KeyW":this._moveForward=!1;break;case"ArrowLeft":case"KeyA":this._moveLeft=!1;break;case"ArrowDown":case"KeyS":this._moveBackward=!1;break;case"ArrowRight":case"KeyD":this._moveRight=!1;break;case"KeyR":this._moveUp=!1;break;case"KeyF":this._moveDown=!1}}function onContextMenu(t){!1!==this.enabled&&t.preventDefault()}export{FirstPersonControls};
//# sourceMappingURL=FirstPersonControls.js.map