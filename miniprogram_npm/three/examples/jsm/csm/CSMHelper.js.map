{"version":3,"file":"node_modules/three/examples/jsm/csm/CSMHelper.js","names":["Group","Mesh","LineSegments","BufferGeometry","LineBasicMaterial","Box3Helper","Box3","PlaneGeometry","MeshBasicMaterial","BufferAttribute","DoubleSide","CSMHelper","constructor","csm","super","this","displayFrustum","displayPlanes","displayShadowBounds","indices","Uint16Array","positions","Float32Array","frustumGeometry","setIndex","setAttribute","frustumLines","add","cascadeLines","cascadePlanes","shadowLines","updateVisibility","i","l","length","cascadeLine","cascadePlane","shadowLineGroup","visible","update","camera","cascades","mainFrustum","frustums","lights","frustumLinePositions","geometry","getAttribute","position","copy","quaternion","scale","updateMatrixWorld","remove","pop","planeMat","transparent","opacity","depthWrite","side","shadowLine","push","frustum","shadowCam","shadow","farVerts","vertices","far","children","box","min","max","z","addVectors","multiplyScalar","subVectors","attach","set","bottom","left","top","right","near","nearVerts","setXYZ","x","y","needsUpdate","dispose","material"],"sources":["node_modules/three/examples/jsm/csm/CSMHelper.js"],"sourcesContent":["import {\n\tGroup,\n\tMesh,\n\tLineSegments,\n\tBufferGeometry,\n\tLineBasicMaterial,\n\tBox3Helper,\n\tBox3,\n\tPlaneGeometry,\n\tMeshBasicMaterial,\n\tBufferAttribute,\n\tDoubleSide\n} from 'three';\n\n/**\n * A helper for visualizing the cascades of a CSM instance.\n *\n * @augments Group\n * @three_import import { CSMHelper } from 'three/addons/csm/CSMHelper.js';\n */\nclass CSMHelper extends Group {\n\n\t/**\n\t * Constructs a new CSM helper.\n\t *\n\t * @param {CSM|CSMShadowNode} csm - The CSM instance to visualize.\n\t */\n\tconstructor( csm ) {\n\n\t\tsuper();\n\n\t\t/**\n\t\t * The CSM instance to visualize.\n\t\t *\n\t\t * @type {CSM|CSMShadowNode}\n\t\t */\n\t\tthis.csm = csm;\n\n\t\t/**\n\t\t * Whether to display the CSM frustum or not.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.displayFrustum = true;\n\n\t\t/**\n\t\t * Whether to display the cascade planes or not.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.displayPlanes = true;\n\n\t\t/**\n\t\t * Whether to display the shadow bounds or not.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default true\n\t\t */\n\t\tthis.displayShadowBounds = true;\n\n\t\tconst indices = new Uint16Array( [ 0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7 ] );\n\t\tconst positions = new Float32Array( 24 );\n\t\tconst frustumGeometry = new BufferGeometry();\n\t\tfrustumGeometry.setIndex( new BufferAttribute( indices, 1 ) );\n\t\tfrustumGeometry.setAttribute( 'position', new BufferAttribute( positions, 3, false ) );\n\t\tconst frustumLines = new LineSegments( frustumGeometry, new LineBasicMaterial() );\n\t\tthis.add( frustumLines );\n\n\t\tthis.frustumLines = frustumLines;\n\t\tthis.cascadeLines = [];\n\t\tthis.cascadePlanes = [];\n\t\tthis.shadowLines = [];\n\n\t}\n\n\t/**\n\t * This method must be called if one of the `display*` properties is changed at runtime.\n\t */\n\tupdateVisibility() {\n\n\t\tconst displayFrustum = this.displayFrustum;\n\t\tconst displayPlanes = this.displayPlanes;\n\t\tconst displayShadowBounds = this.displayShadowBounds;\n\n\t\tconst frustumLines = this.frustumLines;\n\t\tconst cascadeLines = this.cascadeLines;\n\t\tconst cascadePlanes = this.cascadePlanes;\n\t\tconst shadowLines = this.shadowLines;\n\t\tfor ( let i = 0, l = cascadeLines.length; i < l; i ++ ) {\n\n\t\t\tconst cascadeLine = cascadeLines[ i ];\n\t\t\tconst cascadePlane = cascadePlanes[ i ];\n\t\t\tconst shadowLineGroup = shadowLines[ i ];\n\n\t\t\tcascadeLine.visible = displayFrustum;\n\t\t\tcascadePlane.visible = displayFrustum && displayPlanes;\n\t\t\tshadowLineGroup.visible = displayShadowBounds;\n\n\t\t}\n\n\t\tfrustumLines.visible = displayFrustum;\n\n\t}\n\n\t/**\n\t * Updates the helper. This method should be called in the app's animation loop.\n\t */\n\tupdate() {\n\n\t\tconst csm = this.csm;\n\t\tconst camera = csm.camera;\n\t\tconst cascades = csm.cascades;\n\t\tconst mainFrustum = csm.mainFrustum;\n\t\tconst frustums = csm.frustums;\n\t\tconst lights = csm.lights;\n\n\t\tconst frustumLines = this.frustumLines;\n\t\tconst frustumLinePositions = frustumLines.geometry.getAttribute( 'position' );\n\t\tconst cascadeLines = this.cascadeLines;\n\t\tconst cascadePlanes = this.cascadePlanes;\n\t\tconst shadowLines = this.shadowLines;\n\n\t\tif ( camera === null ) return;\n\n\t\tthis.position.copy( camera.position );\n\t\tthis.quaternion.copy( camera.quaternion );\n\t\tthis.scale.copy( camera.scale );\n\t\tthis.updateMatrixWorld( true );\n\n\t\twhile ( cascadeLines.length > cascades ) {\n\n\t\t\tthis.remove( cascadeLines.pop() );\n\t\t\tthis.remove( cascadePlanes.pop() );\n\t\t\tthis.remove( shadowLines.pop() );\n\n\t\t}\n\n\t\twhile ( cascadeLines.length < cascades ) {\n\n\t\t\tconst cascadeLine = new Box3Helper( new Box3(), 0xffffff );\n\t\t\tconst planeMat = new MeshBasicMaterial( { transparent: true, opacity: 0.1, depthWrite: false, side: DoubleSide } );\n\t\t\tconst cascadePlane = new Mesh( new PlaneGeometry(), planeMat );\n\t\t\tconst shadowLineGroup = new Group();\n\t\t\tconst shadowLine = new Box3Helper( new Box3(), 0xffff00 );\n\t\t\tshadowLineGroup.add( shadowLine );\n\n\t\t\tthis.add( cascadeLine );\n\t\t\tthis.add( cascadePlane );\n\t\t\tthis.add( shadowLineGroup );\n\n\t\t\tcascadeLines.push( cascadeLine );\n\t\t\tcascadePlanes.push( cascadePlane );\n\t\t\tshadowLines.push( shadowLineGroup );\n\n\t\t}\n\n\t\tfor ( let i = 0; i < cascades; i ++ ) {\n\n\t\t\tconst frustum = frustums[ i ];\n\t\t\tconst light = lights[ i ];\n\t\t\tconst shadowCam = light.shadow.camera;\n\t\t\tconst farVerts = frustum.vertices.far;\n\n\t\t\tconst cascadeLine = cascadeLines[ i ];\n\t\t\tconst cascadePlane = cascadePlanes[ i ];\n\t\t\tconst shadowLineGroup = shadowLines[ i ];\n\t\t\tconst shadowLine = shadowLineGroup.children[ 0 ];\n\n\t\t\tcascadeLine.box.min.copy( farVerts[ 2 ] );\n\t\t\tcascadeLine.box.max.copy( farVerts[ 0 ] );\n\t\t\tcascadeLine.box.max.z += 1e-4;\n\n\t\t\tcascadePlane.position.addVectors( farVerts[ 0 ], farVerts[ 2 ] );\n\t\t\tcascadePlane.position.multiplyScalar( 0.5 );\n\t\t\tcascadePlane.scale.subVectors( farVerts[ 0 ], farVerts[ 2 ] );\n\t\t\tcascadePlane.scale.z = 1e-4;\n\n\t\t\tthis.remove( shadowLineGroup );\n\t\t\tshadowLineGroup.position.copy( shadowCam.position );\n\t\t\tshadowLineGroup.quaternion.copy( shadowCam.quaternion );\n\t\t\tshadowLineGroup.scale.copy( shadowCam.scale );\n\t\t\tshadowLineGroup.updateMatrixWorld( true );\n\t\t\tthis.attach( shadowLineGroup );\n\n\t\t\tshadowLine.box.min.set( shadowCam.bottom, shadowCam.left, - shadowCam.far );\n\t\t\tshadowLine.box.max.set( shadowCam.top, shadowCam.right, - shadowCam.near );\n\n\t\t}\n\n\t\tconst nearVerts = mainFrustum.vertices.near;\n\t\tconst farVerts = mainFrustum.vertices.far;\n\t\tfrustumLinePositions.setXYZ( 0, farVerts[ 0 ].x, farVerts[ 0 ].y, farVerts[ 0 ].z );\n\t\tfrustumLinePositions.setXYZ( 1, farVerts[ 3 ].x, farVerts[ 3 ].y, farVerts[ 3 ].z );\n\t\tfrustumLinePositions.setXYZ( 2, farVerts[ 2 ].x, farVerts[ 2 ].y, farVerts[ 2 ].z );\n\t\tfrustumLinePositions.setXYZ( 3, farVerts[ 1 ].x, farVerts[ 1 ].y, farVerts[ 1 ].z );\n\n\t\tfrustumLinePositions.setXYZ( 4, nearVerts[ 0 ].x, nearVerts[ 0 ].y, nearVerts[ 0 ].z );\n\t\tfrustumLinePositions.setXYZ( 5, nearVerts[ 3 ].x, nearVerts[ 3 ].y, nearVerts[ 3 ].z );\n\t\tfrustumLinePositions.setXYZ( 6, nearVerts[ 2 ].x, nearVerts[ 2 ].y, nearVerts[ 2 ].z );\n\t\tfrustumLinePositions.setXYZ( 7, nearVerts[ 1 ].x, nearVerts[ 1 ].y, nearVerts[ 1 ].z );\n\t\tfrustumLinePositions.needsUpdate = true;\n\n\t}\n\n\t/**\n\t * Frees the GPU-related resources allocated by this instance. Call this\n\t * method whenever this instance is no longer used in your app.\n\t */\n\tdispose() {\n\n\t\tconst frustumLines = this.frustumLines;\n\t\tconst cascadeLines = this.cascadeLines;\n\t\tconst cascadePlanes = this.cascadePlanes;\n\t\tconst shadowLines = this.shadowLines;\n\n\t\tfrustumLines.geometry.dispose();\n\t\tfrustumLines.material.dispose();\n\n\t\tconst cascades = this.csm.cascades;\n\n\t\tfor ( let i = 0; i < cascades; i ++ ) {\n\n\t\t\tconst cascadeLine = cascadeLines[ i ];\n\t\t\tconst cascadePlane = cascadePlanes[ i ];\n\t\t\tconst shadowLineGroup = shadowLines[ i ];\n\t\t\tconst shadowLine = shadowLineGroup.children[ 0 ];\n\n\t\t\tcascadeLine.dispose(); // Box3Helper\n\n\t\t\tcascadePlane.geometry.dispose();\n\t\t\tcascadePlane.material.dispose();\n\n\t\t\tshadowLine.dispose(); // Box3Helper\n\n\t\t}\n\n\t}\n\n}\n\nexport { CSMHelper };\n"],"mappings":"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","ignoreList":[]}