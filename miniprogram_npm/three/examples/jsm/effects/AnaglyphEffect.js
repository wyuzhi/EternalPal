import{LinearFilter,Matrix3,NearestFilter,RGBAFormat,ShaderMaterial,StereoCamera,WebGLRenderTarget}from"three";import{FullScreenQuad}from"../postprocessing/Pass.js";class AnaglyphEffect{constructor(e,t=512,r=512){this.colorMatrixLeft=(new Matrix3).fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=(new Matrix3).fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);const a=new StereoCamera,o={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat},i=new WebGLRenderTarget(t,r,o),n=new WebGLRenderTarget(t,r,o),l=new ShaderMaterial({uniforms:{mapLeft:{value:i.texture},mapRight:{value:n.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = texture2D( mapLeft, uv );","\tvec4 colorR = texture2D( mapRight, uv );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tcolor.r, color.g, color.b,","\t\t\tmax( colorL.a, colorR.a ) );","\t#include <tonemapping_fragment>","\t#include <colorspace_fragment>","}"].join("\n")}),c=new FullScreenQuad(l);this.setSize=function(t,r){e.setSize(t,r);const a=e.getPixelRatio();i.setSize(t*a,r*a),n.setSize(t*a,r*a)},this.render=function(t,r){const o=e.getRenderTarget();!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===r.parent&&!0===r.matrixWorldAutoUpdate&&r.updateMatrixWorld(),a.update(r),e.setRenderTarget(i),e.clear(),e.render(t,a.cameraL),e.setRenderTarget(n),e.clear(),e.render(t,a.cameraR),e.setRenderTarget(null),c.render(e),e.setRenderTarget(o)},this.dispose=function(){i.dispose(),n.dispose(),l.dispose(),c.dispose()}}}export{AnaglyphEffect};
//# sourceMappingURL=AnaglyphEffect.js.map