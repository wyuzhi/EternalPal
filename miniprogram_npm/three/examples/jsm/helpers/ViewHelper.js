import{CylinderGeometry,CanvasTexture,Color,Euler,Mesh,MeshBasicMaterial,Object3D,OrthographicCamera,Quaternion,Raycaster,Sprite,SpriteMaterial,SRGBColorSpace,Vector2,Vector3,Vector4}from"three";class ViewHelper extends Object3D{constructor(e,t){super(),this.isViewHelper=!0,this.animating=!1,this.center=new Vector3;const a=new Color("#ff4466"),i=new Color("#88ff44"),o=new Color("#4488ff"),r=new Color("#000000"),s={},n=[],l=new Raycaster,p=new Vector2,c=new Object3D,d=new OrthographicCamera(-2,2,2,-2,0,4);d.position.set(0,0,2);const h=new CylinderGeometry(.04,.04,.8,5).rotateZ(-Math.PI/2).translate(.4,0,0),u=new Mesh(h,q(a)),m=new Mesh(h,q(i)),w=new Mesh(h,q(o));m.rotation.z=Math.PI/2,w.rotation.y=-Math.PI/2,this.add(u),this.add(w),this.add(m);const f=H(a),y=H(i),g=H(o),M=H(r),b=new Sprite(f),S=new Sprite(y),C=new Sprite(g),V=new Sprite(M),x=new Sprite(M),E=new Sprite(M);b.position.x=1,S.position.y=1,C.position.z=1,V.position.x=-1,x.position.y=-1,E.position.z=-1,V.material.opacity=.2,x.material.opacity=.2,E.material.opacity=.2,b.userData.type="posX",S.userData.type="posY",C.userData.type="posZ",V.userData.type="negX",x.userData.type="negY",E.userData.type="negZ",this.add(b),this.add(S),this.add(C),this.add(V),this.add(x),this.add(E),n.push(b),n.push(S),n.push(C),n.push(V),n.push(x),n.push(E);const P=new Vector3,D=128,I=2*Math.PI;this.render=function(a){this.quaternion.copy(e.quaternion).invert(),this.updateMatrixWorld(),P.set(0,0,1),P.applyQuaternion(e.quaternion);const i=t.offsetWidth-D,o=a.isWebGPURenderer?t.offsetHeight-D:0;a.clearDepth(),a.getViewport(Y),a.setViewport(i,o,D,D),a.render(this,d),a.setViewport(Y.x,Y.y,Y.z,Y.w)};const k=new Vector3,F=new Quaternion,T=new Quaternion,X=new Quaternion,Y=new Vector4;let Z=0;function q(e){return new MeshBasicMaterial({color:e,toneMapped:!1})}function H(e,t){const{font:a="24px Arial",color:i="#000000",radius:o=14}=s,r=document.createElement("canvas");r.width=64,r.height=64;const n=r.getContext("2d");n.beginPath(),n.arc(32,32,o,0,2*Math.PI),n.closePath(),n.fillStyle=e.getStyle(),n.fill(),t&&(n.font=a,n.textAlign="center",n.fillStyle=i,n.fillText(t,32,41));const l=new CanvasTexture(r);return l.colorSpace=SRGBColorSpace,new SpriteMaterial({map:l,toneMapped:!1})}function O(){b.material.map.dispose(),S.material.map.dispose(),C.material.map.dispose(),b.material.dispose(),S.material.dispose(),C.material.dispose(),b.material=H(a,s.labelX),S.material=H(i,s.labelY),C.material=H(o,s.labelZ)}this.handleClick=function(a){if(!0===this.animating)return!1;const i=t.getBoundingClientRect(),o=i.left+(t.offsetWidth-D),r=i.top+(t.offsetHeight-D);p.x=(a.clientX-o)/(i.right-o)*2-1,p.y=-(a.clientY-r)/(i.bottom-r)*2+1,l.setFromCamera(p,d);const s=l.intersectObjects(n);if(s.length>0){return function(t,a){switch(t.userData.type){case"posX":k.set(1,0,0),F.setFromEuler(new Euler(0,.5*Math.PI,0));break;case"posY":k.set(0,1,0),F.setFromEuler(new Euler(.5*-Math.PI,0,0));break;case"posZ":k.set(0,0,1),F.setFromEuler(new Euler);break;case"negX":k.set(-1,0,0),F.setFromEuler(new Euler(0,.5*-Math.PI,0));break;case"negY":k.set(0,-1,0),F.setFromEuler(new Euler(.5*Math.PI,0,0));break;case"negZ":k.set(0,0,-1),F.setFromEuler(new Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}Z=e.position.distanceTo(a),k.multiplyScalar(Z).add(a),c.position.copy(a),c.lookAt(e.position),T.copy(c.quaternion),c.lookAt(k),X.copy(c.quaternion)}(s[0].object,this.center),this.animating=!0,!0}return!1},this.setLabels=function(e,t,a){s.labelX=e,s.labelY=t,s.labelZ=a,O()},this.setLabelStyle=function(e,t,a){s.font=e,s.color=t,s.radius=a,O()},this.update=function(t){const a=t*I;T.rotateTowards(X,a),e.position.set(0,0,1).applyQuaternion(T).multiplyScalar(Z).add(this.center),e.quaternion.rotateTowards(F,a),0===T.angleTo(X)&&(this.animating=!1)},this.dispose=function(){h.dispose(),u.material.dispose(),m.material.dispose(),w.material.dispose(),b.material.map.dispose(),S.material.map.dispose(),C.material.map.dispose(),V.material.map.dispose(),x.material.map.dispose(),E.material.map.dispose(),b.material.dispose(),S.material.dispose(),C.material.dispose(),V.material.dispose(),x.material.dispose(),E.material.dispose()}}}export{ViewHelper};
//# sourceMappingURL=ViewHelper.js.map