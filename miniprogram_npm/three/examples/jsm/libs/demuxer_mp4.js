import MP4Box from"https://cdn.jsdelivr.net/npm/mp4box@0.5.3/+esm";class MP4FileSink{#t=null;#e=null;#i=0;constructor(t,e){this.#e=t,this.#t=e}write(t){const e=new ArrayBuffer(t.byteLength);new Uint8Array(e).set(t),e.fileStart=this.#i,this.#i+=e.byteLength,this.#t("fetch",(this.#i/1048576).toFixed(1)+" MiB"),this.#e.appendBuffer(e)}close(){this.#t("fetch","Done"),this.#e.flush()}}export class MP4Demuxer{#s=null;#o=null;#t=null;#e=null;constructor(t,{onConfig:e,onChunk:i,setStatus:s}){this.#s=e,this.#o=i,this.#t=s,this.#e=MP4Box.createFile(),this.#e.onError=t=>s("demux",t),this.#e.onReady=this.#n.bind(this),this.#e.onSamples=this.#a.bind(this);const o=new MP4FileSink(this.#e,s);fetch(t).then((t=>{t.body.pipeTo(new WritableStream(o,{highWaterMark:2}))}))}#h(t){const e=this.#e.getTrackById(t.id);for(const t of e.mdia.minf.stbl.stsd.entries){const e=t.avcC||t.hvcC||t.vpcC||t.av1C;if(e){const t=new MP4Box.DataStream(void 0,0,MP4Box.DataStream.BIG_ENDIAN);return e.write(t),new Uint8Array(t.buffer,8)}}throw new Error("avcC, hvcC, vpcC, or av1C box not found")}#n(t){this.#t("demux","Ready");const e=t.videoTracks[0];this.#s({codec:e.codec.startsWith("vp08")?"vp8":e.codec,codedHeight:e.video.height,codedWidth:e.video.width,description:this.#h(e)}),this.#e.setExtractionOptions(e.id),this.#e.start()}#a(t,e,i){for(const t of i)this.#o(new EncodedVideoChunk({type:t.is_sync?"key":"delta",timestamp:1e6*t.cts/t.timescale,duration:1e6*t.duration/t.timescale,data:t.data}))}}
//# sourceMappingURL=demuxer_mp4.js.map