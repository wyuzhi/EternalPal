import{Color,LightProbe,LinearSRGBColorSpace,SphericalHarmonics3,Vector3,SRGBColorSpace,NoColorSpace,HalfFloatType,DataUtils,WebGLCoordinateSystem,FloatType}from"three";class LightProbeGenerator{static fromCubeTexture(e){let t=0;const r=new Vector3,o=new Vector3,a=new Color,c=[0,0,0,0,0,0,0,0,0],n=new SphericalHarmonics3,s=n.coefficients;for(let n=0;n<6;n++){const l=e.image[n],i=l.width,h=l.height,f=document.createElement("canvas");f.width=i,f.height=h;const p=f.getContext("2d");p.drawImage(l,0,0,i,h);const b=p.getImageData(0,0,i,h),g=b.data,w=b.width,S=2/w;for(let l=0,i=g.length;l<i;l+=4){a.setRGB(g[l]/255,g[l+1]/255,g[l+2]/255),convertColorToLinear(a,e.colorSpace);const i=l/4,h=(i%w+.5)*S-1,f=1-(Math.floor(i/w)+.5)*S;switch(n){case 0:r.set(-1,f,-h);break;case 1:r.set(1,f,h);break;case 2:r.set(-h,1,-f);break;case 3:r.set(-h,-1,f);break;case 4:r.set(-h,f,1);break;case 5:r.set(h,f,-1)}const p=r.lengthSq(),b=4/(Math.sqrt(p)*p);t+=b,o.copy(r).normalize(),SphericalHarmonics3.getBasisAt(o,c);for(let e=0;e<9;e++)s[e].x+=c[e]*a.r*b,s[e].y+=c[e]*a.g*b,s[e].z+=c[e]*a.b*b}}const l=4*Math.PI/t;for(let e=0;e<9;e++)s[e].x*=l,s[e].y*=l,s[e].z*=l;return new LightProbe(n)}static async fromCubeRenderTarget(e,t){const r=e.coordinateSystem===WebGLCoordinateSystem?-1:1;let o=0;const a=new Vector3,c=new Vector3,n=new Color,s=[0,0,0,0,0,0,0,0,0],l=new SphericalHarmonics3,i=l.coefficients,h=t.texture.type,f=t.width;let p;e.isWebGLRenderer&&(p=h===FloatType?new Float32Array(f*f*4):h===HalfFloatType?new Uint16Array(f*f*4):new Uint8Array(f*f*4));for(let l=0;l<6;l++){e.isWebGLRenderer?await e.readRenderTargetPixelsAsync(t,0,0,f,f,p,l):p=await e.readRenderTargetPixelsAsync(t,0,0,f,f,0,l);const b=2/f;for(let e=0,g=p.length;e<g;e+=4){let g,w,S;h===FloatType?(g=p[e],w=p[e+1],S=p[e+2]):h===HalfFloatType?(g=DataUtils.fromHalfFloat(p[e]),w=DataUtils.fromHalfFloat(p[e+1]),S=DataUtils.fromHalfFloat(p[e+2])):(g=p[e]/255,w=p[e+1]/255,S=p[e+2]/255),n.setRGB(g,w,S),convertColorToLinear(n,t.texture.colorSpace);const m=e/4,y=(1-(m%f+.5)*b)*r,d=1-(Math.floor(m/f)+.5)*b;switch(l){case 0:a.set(-1*r,d,y*r);break;case 1:a.set(1*r,d,-y*r);break;case 2:a.set(y,1,-d);break;case 3:a.set(y,-1,d);break;case 4:a.set(y,d,1);break;case 5:a.set(-y,d,-1)}const C=a.lengthSq(),L=4/(Math.sqrt(C)*C);o+=L,c.copy(a).normalize(),SphericalHarmonics3.getBasisAt(c,s);for(let e=0;e<9;e++)i[e].x+=s[e]*n.r*L,i[e].y+=s[e]*n.g*L,i[e].z+=s[e]*n.b*L}}const b=4*Math.PI/o;for(let e=0;e<9;e++)i[e].x*=b,i[e].y*=b,i[e].z*=b;return new LightProbe(l)}}function convertColorToLinear(e,t){switch(t){case SRGBColorSpace:e.convertSRGBToLinear();break;case LinearSRGBColorSpace:case NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.")}return e}export{LightProbeGenerator};
//# sourceMappingURL=LightProbeGenerator.js.map