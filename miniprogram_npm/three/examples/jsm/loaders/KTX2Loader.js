import{CompressedArrayTexture,CompressedCubeTexture,CompressedTexture,Data3DTexture,DataTexture,FileLoader,FloatType,HalfFloatType,LinearFilter,LinearMipmapLinearFilter,LinearSRGBColorSpace,Loader,NoColorSpace,RGBAFormat,RGBA_ASTC_4x4_Format,RGBA_ASTC_6x6_Format,RGBA_BPTC_Format,RGBA_S3TC_DXT3_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT5_Format,RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format,RGFormat,RedFormat,SRGBColorSpace,UnsignedByteType}from"three";import{WorkerPool}from"../utils/WorkerPool.js";import{read,KHR_DF_FLAG_ALPHA_PREMULTIPLIED,KHR_DF_PRIMARIES_BT709,KHR_DF_PRIMARIES_DISPLAYP3,KHR_DF_PRIMARIES_UNSPECIFIED,KHR_DF_TRANSFER_SRGB,KHR_SUPERCOMPRESSION_NONE,KHR_SUPERCOMPRESSION_ZSTD,VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT,VK_FORMAT_ASTC_4x4_SRGB_BLOCK,VK_FORMAT_ASTC_4x4_UNORM_BLOCK,VK_FORMAT_ASTC_6x6_SRGB_BLOCK,VK_FORMAT_ASTC_6x6_UNORM_BLOCK,VK_FORMAT_BC1_RGBA_SRGB_BLOCK,VK_FORMAT_BC1_RGBA_UNORM_BLOCK,VK_FORMAT_BC1_RGB_SRGB_BLOCK,VK_FORMAT_BC1_RGB_UNORM_BLOCK,VK_FORMAT_BC3_SRGB_BLOCK,VK_FORMAT_BC3_UNORM_BLOCK,VK_FORMAT_BC5_SNORM_BLOCK,VK_FORMAT_BC5_UNORM_BLOCK,VK_FORMAT_BC7_SRGB_BLOCK,VK_FORMAT_BC7_UNORM_BLOCK,VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK,VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK,VK_FORMAT_R16G16B16A16_SFLOAT,VK_FORMAT_R16G16_SFLOAT,VK_FORMAT_R16_SFLOAT,VK_FORMAT_R32G32B32A32_SFLOAT,VK_FORMAT_R32G32_SFLOAT,VK_FORMAT_R32_SFLOAT,VK_FORMAT_R8G8B8A8_SRGB,VK_FORMAT_R8G8B8A8_UNORM,VK_FORMAT_R8G8_SRGB,VK_FORMAT_R8G8_UNORM,VK_FORMAT_R8_SRGB,VK_FORMAT_R8_UNORM,VK_FORMAT_UNDEFINED}from"../libs/ktx-parse.module.js";import{ZSTDDecoder}from"../libs/zstddec.module.js";import{DisplayP3ColorSpace,LinearDisplayP3ColorSpace}from"../math/ColorSpaces.js";const _taskCache=new WeakMap;let _zstd,_activeLoaders=0;class KTX2Loader extends Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WorkerPool,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),r=new FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const o=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,o]).then((([e,t])=>{const r=KTX2Loader.BasisWorker.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(KTX2Loader.EngineFormat),"let _EngineType = "+JSON.stringify(KTX2Loader.EngineType),"let _TranscoderFormat = "+JSON.stringify(KTX2Loader.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(KTX2Loader.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),_activeLoaders>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),_activeLoaders++}return this.transcoderPending}load(e,t,r,o){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const _=new FileLoader(this.manager);_.setPath(this.path),_.setCrossOrigin(this.crossOrigin),_.setWithCredentials(this.withCredentials),_.setResponseType("arraybuffer"),_.load(e,(e=>{this.parse(e,t,o)}),r,o)}parse(e,t,r){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(_taskCache.has(e)){return _taskCache.get(e).promise.then(t).catch(r)}this._createTexture(e).then((e=>t?t(e):null)).catch(r)}_createTextureFrom(e,t){const{type:r,error:o,data:{faces:_,width:a,height:s,format:i,type:n,dfdFlags:T}}=e;if("error"===r)return Promise.reject(o);let R;if(6===t.faceCount)R=new CompressedCubeTexture(_,i,n);else{const e=_[0].mipmaps;R=t.layerCount>1?new CompressedArrayTexture(e,a,s,t.layerCount,i,n):new CompressedTexture(e,a,s,i,n)}return R.minFilter=1===_[0].mipmaps.length?LinearFilter:LinearMipmapLinearFilter,R.magFilter=LinearFilter,R.generateMipmaps=!1,R.needsUpdate=!0,R.colorSpace=parseColorSpace(t),R.premultiplyAlpha=!!(T&KHR_DF_FLAG_ALPHA_PREMULTIPLIED),R}async _createTexture(e,t={}){const r=read(new Uint8Array(e)),o=r.vkFormat===VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT&&167===r.dataFormatDescriptor[0].colorModel;if(!(r.vkFormat===VK_FORMAT_UNDEFINED||o&&!this.workerConfig.astcHDRSupported))return createRawTexture(r);const _=t,a=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:_},[e]))).then((e=>this._createTextureFrom(e.data,r)));return _taskCache.set(e,{promise:a}),a}dispose(){this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),_activeLoaders--}}KTX2Loader.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},KTX2Loader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},KTX2Loader.EngineFormat={RGBAFormat:RGBAFormat,RGBA_ASTC_4x4_Format:RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format:RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format:RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:RGB_ETC1_Format,RGB_ETC2_Format:RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:RGBA_S3TC_DXT1_Format},KTX2Loader.EngineType={UnsignedByteType:UnsignedByteType,HalfFloatType:HalfFloatType,FloatType:FloatType},KTX2Loader.BasisWorker=function(){let e,t,r;const o=_EngineFormat,_=_EngineType,a=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",(function(o){const a=o.data;switch(a.type){case"init":e=a.config,i=a.transcoderBinary,t=new Promise((e=>{r={wasmBinary:i,onRuntimeInitialized:e},BASIS(r)})).then((()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:o,width:i,height:F,hasAlpha:p,format:A,type:B,dfdFlags:d}=function(t){const o=new r.KTX2File(new Uint8Array(t));function a(){o.close(),o.delete()}if(!o.isValid())throw a(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let i;if(o.isUASTC())i=s.UASTC;else if(o.isETC1S())i=s.ETC1S;else{if(!o.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");i=s.UASTC_HDR}const F=o.getWidth(),p=o.getHeight(),A=o.getLayers()||1,B=o.getLevels(),d=o.getFaces(),c=o.getHasAlpha(),C=o.getDFDFlags(),{transcoderFormat:S,engineFormat:m,engineType:l}=function(t,r,o,_){const a=n[t];for(let s=0;s<a.length;s++){const i=a[s];if(i.if&&!e[i.if])continue;if(!i.basisFormat.includes(t))continue;if(_&&i.transcoderFormat.length<2)continue;if(i.needsPowerOfTwo&&(!T(r)||!T(o)))continue;return{transcoderFormat:i.transcoderFormat[_?1:0],engineFormat:i.engineFormat[_?1:0],engineType:i.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(i,F,p,c);if(!F||!p||!B)throw a(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!o.startTranscoding())throw a(),new Error("THREE.KTX2Loader: .startTranscoding failed");const O=[],h=[];for(let e=0;e<d;e++){const t=[];for(let r=0;r<B;r++){const s=[];let i,n;for(let t=0;t<A;t++){const T=o.getImageLevelInfo(r,t,e);0!==e||0!==r||0!==t||T.origWidth%4==0&&T.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),B>1?(i=T.origWidth,n=T.origHeight):(i=T.width,n=T.height);let R=new Uint8Array(o.getImageTranscodedSizeInBytes(r,t,0,S));const F=o.transcodeImage(R,r,t,e,S,0,-1,-1);if(l===_.HalfFloatType&&(R=new Uint16Array(R.buffer,R.byteOffset,R.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!F)throw a(),new Error("THREE.KTX2Loader: .transcodeImage failed.");s.push(R)}const T=R(s);t.push({data:T,width:i,height:n}),h.push(T.buffer)}O.push({mipmaps:t,width:F,height:p,format:m,type:l})}return a(),{faces:O,buffers:h,width:F,height:p,hasAlpha:c,dfdFlags:C,format:m,type:l}}(a.buffer);self.postMessage({type:"transcode",id:a.id,data:{faces:t,width:i,height:F,hasAlpha:p,format:A,type:B,dfdFlags:d}},o)}catch(e){console.error(e),self.postMessage({type:"error",id:a.id,error:e.message})}}))}var i}));const i=[{if:"astcSupported",basisFormat:[s.UASTC],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[o.RGBA_ASTC_4x4_Format,o.RGBA_ASTC_4x4_Format],engineType:[_.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[o.RGBA_BPTC_Format,o.RGBA_BPTC_Format],engineType:[_.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[a.BC1,a.BC3],engineFormat:[o.RGBA_S3TC_DXT1_Format,o.RGBA_S3TC_DXT5_Format],engineType:[_.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[o.RGB_ETC2_Format,o.RGBA_ETC2_EAC_Format],engineType:[_.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[a.ETC1],engineFormat:[o.RGB_ETC1_Format],engineType:[_.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[o.RGB_PVRTC_4BPPV1_Format,o.RGBA_PVRTC_4BPPV1_Format],engineType:[_.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[s.UASTC_HDR],transcoderFormat:[a.BC6H],engineFormat:[o.RGB_BPTC_UNSIGNED_Format],engineType:[_.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[a.RGBA32,a.RGBA32],engineFormat:[o.RGBAFormat,o.RGBAFormat],engineType:[_.UnsignedByteType,_.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[s.UASTC_HDR],transcoderFormat:[a.RGBA_HALF],engineFormat:[o.RGBAFormat],engineType:[_.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],n={[s.ETC1S]:i.filter((e=>e.basisFormat.includes(s.ETC1S))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[s.UASTC]:i.filter((e=>e.basisFormat.includes(s.UASTC))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[s.UASTC_HDR]:i.filter((e=>e.basisFormat.includes(s.UASTC_HDR))).sort(((e,t)=>e.priorityHDR-t.priorityHDR))};function T(e){return e<=2||0==(e&e-1)&&0!==e}function R(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++){t+=e[r].byteLength}const r=new Uint8Array(t);let o=0;for(let t=0;t<e.length;t++){const _=e[t];r.set(_,o),o+=_.byteLength}return r}};const UNCOMPRESSED_FORMATS=new Set([RGBAFormat,RGFormat,RedFormat]),FORMAT_MAP={[VK_FORMAT_R32G32B32A32_SFLOAT]:RGBAFormat,[VK_FORMAT_R16G16B16A16_SFLOAT]:RGBAFormat,[VK_FORMAT_R8G8B8A8_UNORM]:RGBAFormat,[VK_FORMAT_R8G8B8A8_SRGB]:RGBAFormat,[VK_FORMAT_R32G32_SFLOAT]:RGFormat,[VK_FORMAT_R16G16_SFLOAT]:RGFormat,[VK_FORMAT_R8G8_UNORM]:RGFormat,[VK_FORMAT_R8G8_SRGB]:RGFormat,[VK_FORMAT_R32_SFLOAT]:RedFormat,[VK_FORMAT_R16_SFLOAT]:RedFormat,[VK_FORMAT_R8_SRGB]:RedFormat,[VK_FORMAT_R8_UNORM]:RedFormat,[VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK]:RGB_ETC2_Format,[VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK]:RGBA_ETC2_EAC_Format,[VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT]:RGBA_ASTC_4x4_Format,[VK_FORMAT_ASTC_4x4_SRGB_BLOCK]:RGBA_ASTC_4x4_Format,[VK_FORMAT_ASTC_4x4_UNORM_BLOCK]:RGBA_ASTC_4x4_Format,[VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:RGBA_ASTC_6x6_Format,[VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:RGBA_ASTC_6x6_Format,[VK_FORMAT_BC1_RGBA_UNORM_BLOCK]:RGBA_S3TC_DXT1_Format,[VK_FORMAT_BC1_RGBA_SRGB_BLOCK]:RGBA_S3TC_DXT1_Format,[VK_FORMAT_BC1_RGB_UNORM_BLOCK]:RGB_S3TC_DXT1_Format,[VK_FORMAT_BC1_RGB_SRGB_BLOCK]:RGB_S3TC_DXT1_Format,[VK_FORMAT_BC3_SRGB_BLOCK]:RGBA_S3TC_DXT3_Format,[VK_FORMAT_BC3_UNORM_BLOCK]:RGBA_S3TC_DXT3_Format,[VK_FORMAT_BC5_SNORM_BLOCK]:RGBA_S3TC_DXT5_Format,[VK_FORMAT_BC5_UNORM_BLOCK]:RGBA_S3TC_DXT5_Format,[VK_FORMAT_BC7_SRGB_BLOCK]:RGBA_BPTC_Format,[VK_FORMAT_BC7_UNORM_BLOCK]:RGBA_BPTC_Format},TYPE_MAP={[VK_FORMAT_R32G32B32A32_SFLOAT]:FloatType,[VK_FORMAT_R16G16B16A16_SFLOAT]:HalfFloatType,[VK_FORMAT_R8G8B8A8_UNORM]:UnsignedByteType,[VK_FORMAT_R8G8B8A8_SRGB]:UnsignedByteType,[VK_FORMAT_R32G32_SFLOAT]:FloatType,[VK_FORMAT_R16G16_SFLOAT]:HalfFloatType,[VK_FORMAT_R8G8_UNORM]:UnsignedByteType,[VK_FORMAT_R8G8_SRGB]:UnsignedByteType,[VK_FORMAT_R32_SFLOAT]:FloatType,[VK_FORMAT_R16_SFLOAT]:HalfFloatType,[VK_FORMAT_R8_SRGB]:UnsignedByteType,[VK_FORMAT_R8_UNORM]:UnsignedByteType,[VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK]:UnsignedByteType,[VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK]:UnsignedByteType,[VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT]:HalfFloatType,[VK_FORMAT_ASTC_6x6_SRGB_BLOCK]:UnsignedByteType,[VK_FORMAT_ASTC_6x6_UNORM_BLOCK]:UnsignedByteType};async function createRawTexture(e){const{vkFormat:t}=e;if(void 0===FORMAT_MAP[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let r;e.supercompressionScheme===KHR_SUPERCOMPRESSION_ZSTD&&(_zstd||(_zstd=new Promise((async e=>{const t=new ZSTDDecoder;await t.init(),e(t)}))),r=await _zstd);const o=[];for(let _=0;_<e.levels.length;_++){const a=Math.max(1,e.pixelWidth>>_),s=Math.max(1,e.pixelHeight>>_),i=e.pixelDepth?Math.max(1,e.pixelDepth>>_):0,n=e.levels[_];let T,R;if(e.supercompressionScheme===KHR_SUPERCOMPRESSION_NONE)T=n.levelData;else{if(e.supercompressionScheme!==KHR_SUPERCOMPRESSION_ZSTD)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");T=r.decode(n.levelData,n.uncompressedByteLength)}R=TYPE_MAP[t]===FloatType?new Float32Array(T.buffer,T.byteOffset,T.byteLength/Float32Array.BYTES_PER_ELEMENT):TYPE_MAP[t]===HalfFloatType?new Uint16Array(T.buffer,T.byteOffset,T.byteLength/Uint16Array.BYTES_PER_ELEMENT):T,o.push({data:R,width:a,height:s,depth:i})}let _;if(UNCOMPRESSED_FORMATS.has(FORMAT_MAP[t]))_=0===e.pixelDepth?new DataTexture(o[0].data,e.pixelWidth,e.pixelHeight):new Data3DTexture(o[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");_=new CompressedTexture(o,e.pixelWidth,e.pixelHeight),_.minFilter=1===o.length?LinearFilter:LinearMipmapLinearFilter,_.magFilter=LinearFilter}return _.mipmaps=o,_.type=TYPE_MAP[t],_.format=FORMAT_MAP[t],_.colorSpace=parseColorSpace(e),_.needsUpdate=!0,Promise.resolve(_)}function parseColorSpace(e){const t=e.dataFormatDescriptor[0];return t.colorPrimaries===KHR_DF_PRIMARIES_BT709?t.transferFunction===KHR_DF_TRANSFER_SRGB?SRGBColorSpace:LinearSRGBColorSpace:t.colorPrimaries===KHR_DF_PRIMARIES_DISPLAYP3?t.transferFunction===KHR_DF_TRANSFER_SRGB?DisplayP3ColorSpace:LinearDisplayP3ColorSpace:(t.colorPrimaries===KHR_DF_PRIMARIES_UNSPECIFIED||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),NoColorSpace)}export{KTX2Loader};
//# sourceMappingURL=KTX2Loader.js.map