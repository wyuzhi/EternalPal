import{FileLoader,Loader}from"three";import opentype from"../libs/opentype.module.js";class TTFLoader extends Loader{constructor(e){super(e),this.reversed=!1}load(e,o,t,n){const s=this,r=new FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(t){try{o(s.parse(t))}catch(o){n?n(o):console.error(o),s.manager.itemError(e)}}),t,n)}parse(e){function o(e){const o=[];let t;e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],o.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));const n=[];return o.forEach((function(e){const o={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};n.push(o);for(let o=e.length-1;o>0;o--){const t=e[o],s={type:t.type};void 0!==t.x2&&void 0!==t.y2?(s.x1=t.x2,s.y1=t.y2,s.x2=t.x1,s.y2=t.y1):void 0!==t.x1&&void 0!==t.y1&&(s.x1=t.x1,s.y1=t.y1),s.x=e[o-1].x,s.y=e[o-1].y,n.push(s)}})),n}return function(e,t){const n=Math.round,s={},r=1e5/(72*(e.unitsPerEm||2048)),a=e.encoding.cmap.glyphIndexMap,i=Object.keys(a);for(let d=0;d<i.length;d++){const y=i[d],c=e.glyphs.glyphs[a[y]];if(void 0!==y){const e={ha:n(c.advanceWidth*r),x_min:n(c.xMin*r),x_max:n(c.xMax*r),o:""};t&&(c.path.commands=o(c.path.commands)),c.path.commands.forEach((function(o){"c"===o.type.toLowerCase()&&(o.type="b"),e.o+=o.type.toLowerCase()+" ",void 0!==o.x&&void 0!==o.y&&(e.o+=n(o.x*r)+" "+n(o.y*r)+" "),void 0!==o.x1&&void 0!==o.y1&&(e.o+=n(o.x1*r)+" "+n(o.y1*r)+" "),void 0!==o.x2&&void 0!==o.y2&&(e.o+=n(o.x2*r)+" "+n(o.y2*r)+" ")})),Array.isArray(c.unicodes)&&c.unicodes.length>0?c.unicodes.forEach((function(o){s[String.fromCodePoint(o)]=e})):s[String.fromCodePoint(c.unicode)]=e}}return{glyphs:s,familyName:e.getEnglishName("fullName"),ascender:n(e.ascender*r),descender:n(e.descender*r),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}}export{TTFLoader};
//# sourceMappingURL=TTFLoader.js.map