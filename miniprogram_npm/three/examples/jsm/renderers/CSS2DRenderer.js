import{Matrix4,Object3D,Vector2,Vector3}from"three";class CSS2DObject extends Object3D{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Vector2(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const _vector=new Vector3,_viewMatrix=new Matrix4,_viewProjectionMatrix=new Matrix4,_a=new Vector3,_b=new Vector3;class CSS2DRenderer{constructor(e={}){const t=this;let r,n,i,o;const s={objects:new WeakMap},c=void 0!==e.element?e.element:document.createElement("div");function l(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,r=e.children.length;t<r;t++)l(e.children[t])}function a(e,r,n){if(!1!==e.visible){if(e.isCSS2DObject){_vector.setFromMatrixPosition(e.matrixWorld),_vector.applyMatrix4(_viewProjectionMatrix);const l=_vector.z>=-1&&_vector.z<=1&&!0===e.layers.test(n.layers),a=e.element;a.style.display=!0===l?"":"none",!0===l&&(e.onBeforeRender(t,r,n),a.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(_vector.x*i+i)+"px,"+(-_vector.y*o+o)+"px)",a.parentNode!==c&&c.appendChild(a),e.onAfterRender(t,r,n));const m={distanceToCameraSquared:d(n,e)};s.objects.set(e,m)}for(let t=0,i=e.children.length;t<i;t++)a(e.children[t],r,n)}else l(e)}function d(e,t){return _a.setFromMatrixPosition(e.matrixWorld),_b.setFromMatrixPosition(t.matrixWorld),_a.distanceToSquared(_b)}c.style.overflow="hidden",this.domElement=c,this.getSize=function(){return{width:r,height:n}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),_viewMatrix.copy(t.matrixWorldInverse),_viewProjectionMatrix.multiplyMatrices(t.projectionMatrix,_viewMatrix),a(e,e,t),function(e){const t=function(e){const t=[];return e.traverseVisible((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return s.objects.get(e).distanceToCameraSquared-s.objects.get(t).distanceToCameraSquared})),r=t.length;for(let e=0,n=t.length;e<n;e++)t[e].element.style.zIndex=r-e}(e)},this.setSize=function(e,t){r=e,n=t,i=r/2,o=n/2,c.style.width=e+"px",c.style.height=t+"px"}}}export{CSS2DObject,CSS2DRenderer};
//# sourceMappingURL=CSS2DRenderer.js.map