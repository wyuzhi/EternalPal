import{Box2,Camera,Color,Matrix3,Matrix4,Object3D,SRGBColorSpace,Vector3}from"three";import{Projector,RenderableFace,RenderableLine,RenderableSprite}from"../renderers/Projector.js";class SVGObject extends Object3D{constructor(e){super(),this.isSVGObject=!0,this.node=e}}class SVGRenderer{constructor(){let e,t,i,o,r,n,s,c,a,l,p,d,S,u=0,h=null,f=1;const y=this,m=new Box2,x=new Box2,g=new Color,w=new Color,b=new Color,M=new Color,C=new Color,v=new Color,z=new Vector3,R=new Vector3,j=new Vector3,L=new Matrix3,k=new Matrix4,P=new Matrix4,B=[],G=new Projector,V=document.createElementNS("http://www.w3.org/2000/svg","svg");function E(){for(u=0;V.childNodes.length>0;)V.removeChild(V.childNodes[0])}function A(e){return null!==h?e.toFixed(h):e}function F(e,t,i){let o=t.scale.x*n,r=t.scale.y*s;i.isPointsMaterial&&(o*=i.size,r*=i.size);const c="M"+A(e.x-.5*o)+","+A(e.y-.5*r)+"h"+A(o)+"v"+A(r)+"h"+A(-o)+"z";let a="";(i.isSpriteMaterial||i.isPointsMaterial)&&(a="fill:"+i.color.getStyle(y.outputColorSpace)+";fill-opacity:"+i.opacity),D(a,c)}function O(e,t,i){const o="M"+A(e.positionScreen.x)+","+A(e.positionScreen.y)+"L"+A(t.positionScreen.x)+","+A(t.positionScreen.y);if(i.isLineBasicMaterial){let e="fill:none;stroke:"+i.color.getStyle(y.outputColorSpace)+";stroke-opacity:"+i.opacity+";stroke-width:"+i.linewidth+";stroke-linecap:"+i.linecap;i.isLineDashedMaterial&&(e=e+";stroke-dasharray:"+i.dashSize+","+i.gapSize),D(e,o)}}function W(e,t,o,r,n){y.info.render.vertices+=3,y.info.render.faces++;const s="M"+A(e.positionScreen.x)+","+A(e.positionScreen.y)+"L"+A(t.positionScreen.x)+","+A(t.positionScreen.y)+"L"+A(o.positionScreen.x)+","+A(o.positionScreen.y)+"z";let c="";n.isMeshBasicMaterial?(g.copy(n.color),n.vertexColors&&g.multiply(r.color)):n.isMeshLambertMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial?(w.copy(n.color),n.vertexColors&&w.multiply(r.color),g.copy(b),R.copy(e.positionWorld).add(t.positionWorld).add(o.positionWorld).divideScalar(3),function(e,t,i,o){for(let r=0,n=e.length;r<n;r++){const n=e[r],s=n.color;if(n.isDirectionalLight){const e=z.setFromMatrixPosition(n.matrixWorld).normalize();let t=i.dot(e);if(t<=0)continue;t*=n.intensity,o.r+=s.r*t,o.g+=s.g*t,o.b+=s.b*t}else if(n.isPointLight){const e=z.setFromMatrixPosition(n.matrixWorld);let r=i.dot(z.subVectors(e,t).normalize());if(r<=0)continue;if(r*=0==n.distance?1:1-Math.min(t.distanceTo(e)/n.distance,1),0==r)continue;r*=n.intensity,o.r+=s.r*r,o.g+=s.g*r,o.b+=s.b*r}}}(i,R,r.normalModel,g),g.multiply(w).add(n.emissive)):n.isMeshNormalMaterial&&(j.copy(r.normalModel).applyMatrix3(L).normalize(),g.setRGB(j.x,j.y,j.z).multiplyScalar(.5).addScalar(.5)),c=n.wireframe?"fill:none;stroke:"+g.getStyle(y.outputColorSpace)+";stroke-opacity:"+n.opacity+";stroke-width:"+n.wireframeLinewidth+";stroke-linecap:"+n.wireframeLinecap+";stroke-linejoin:"+n.wireframeLinejoin:"fill:"+g.getStyle(y.outputColorSpace)+";fill-opacity:"+n.opacity,D(c,s)}function N(e,t,i){let o=t.x-e.x,r=t.y-e.y;const n=o*o+r*r;if(0===n)return;const s=i/Math.sqrt(n);o*=s,r*=s,t.x+=o,t.y+=r,e.x-=o,e.y-=r}function D(e,t){S===e?d+=t:(I(),S=e,d=t)}function I(){d&&(p=function(e){if(null==B[e])return B[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==f&&B[e].setAttribute("shape-rendering","crispEdges"),B[e];return B[e]}(u++),p.setAttribute("d",d),p.setAttribute("style",S),V.appendChild(p)),d="",S=""}this.domElement=V,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.outputColorSpace=SRGBColorSpace,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":f=1;break;case"low":f=0}},this.setClearColor=function(e){v.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){o=e,r=t,n=o/2,s=r/2,V.setAttribute("viewBox",-n+" "+-s+" "+o+" "+r),V.setAttribute("width",o),V.setAttribute("height",r),m.min.set(-n,-s),m.max.set(n,s)},this.getSize=function(){return{width:o,height:r}},this.setPrecision=function(e){h=e},this.clear=function(){E(),V.style.backgroundColor=v.getStyle(y.outputColorSpace)},this.render=function(o,r){if(r instanceof Camera==!1)return void console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");const p=o.background;p&&p.isColor?(E(),V.style.backgroundColor=p.getStyle(y.outputColorSpace)):!0===this.autoClear&&this.clear(),y.info.render.vertices=0,y.info.render.faces=0,k.copy(r.matrixWorldInverse),P.multiplyMatrices(r.projectionMatrix,k),e=G.projectScene(o,r,this.sortObjects,this.sortElements),t=e.elements,i=e.lights,L.getNormalMatrix(r.matrixWorldInverse),function(e){b.setRGB(0,0,0),M.setRGB(0,0,0),C.setRGB(0,0,0);for(let t=0,i=e.length;t<i;t++){const i=e[t],o=i.color;i.isAmbientLight?(b.r+=o.r,b.g+=o.g,b.b+=o.b):i.isDirectionalLight?(M.r+=o.r,M.g+=o.g,M.b+=o.b):i.isPointLight&&(C.r+=o.r,C.g+=o.g,C.b+=o.b)}}(i),d="",S="";for(let e=0,i=t.length;e<i;e++){const i=t[e],o=i.material;if(void 0!==o&&0!==o.opacity)if(x.makeEmpty(),i instanceof RenderableSprite)c=i,c.x*=n,c.y*=-s,F(c,i,o);else if(i instanceof RenderableLine)c=i.v1,a=i.v2,c.positionScreen.x*=n,c.positionScreen.y*=-s,a.positionScreen.x*=n,a.positionScreen.y*=-s,x.setFromPoints([c.positionScreen,a.positionScreen]),!0===m.intersectsBox(x)&&O(c,a,o);else if(i instanceof RenderableFace){if(c=i.v1,a=i.v2,l=i.v3,c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(a.positionScreen.z<-1||a.positionScreen.z>1)continue;if(l.positionScreen.z<-1||l.positionScreen.z>1)continue;c.positionScreen.x*=n,c.positionScreen.y*=-s,a.positionScreen.x*=n,a.positionScreen.y*=-s,l.positionScreen.x*=n,l.positionScreen.y*=-s,this.overdraw>0&&(N(c.positionScreen,a.positionScreen,this.overdraw),N(a.positionScreen,l.positionScreen,this.overdraw),N(l.positionScreen,c.positionScreen,this.overdraw)),x.setFromPoints([c.positionScreen,a.positionScreen,l.positionScreen]),!0===m.intersectsBox(x)&&W(c,a,l,i,o)}}I(),o.traverseVisible((function(e){if(e.isSVGObject){if(z.setFromMatrixPosition(e.matrixWorld),z.applyMatrix4(P),z.z<-1||z.z>1)return;const t=z.x*n,i=-z.y*s,o=e.node;o.setAttribute("transform","translate("+t+","+i+")"),V.appendChild(o)}}))}}}export{SVGObject,SVGRenderer};
//# sourceMappingURL=SVGRenderer.js.map