import{LineSegments}from"../objects/LineSegments.js";import{Matrix4}from"../math/Matrix4.js";import{LineBasicMaterial}from"../materials/LineBasicMaterial.js";import{Color}from"../math/Color.js";import{Vector3}from"../math/Vector3.js";import{BufferGeometry}from"../core/BufferGeometry.js";import{Float32BufferAttribute}from"../core/BufferAttribute.js";const _vector=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const e=getBoneList(t),r=new BufferGeometry,o=[],i=[];for(let t=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),i.push(0,0,0),i.push(0,0,0))}r.setAttribute("position",new Float32BufferAttribute(o,3)),r.setAttribute("color",new Float32BufferAttribute(i,3));super(r,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;const s=new Color(255),n=new Color(65280);this.setColors(s,n)}updateMatrixWorld(t){const e=this.bones,r=this.geometry,o=r.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let t=0,r=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,i.matrixWorld),_vector.setFromMatrixPosition(_boneMatrix),o.setXYZ(r,_vector.x,_vector.y,_vector.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,i.parent.matrixWorld),_vector.setFromMatrixPosition(_boneMatrix),o.setXYZ(r+1,_vector.x,_vector.y,_vector.z),r+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}setColors(t,e){const r=this.geometry.getAttribute("color");for(let o=0;o<r.count;o+=2)r.setXYZ(o,t.r,t.g,t.b),r.setXYZ(o+1,e.r,e.g,e.b);return r.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(t){const e=[];!0===t.isBone&&e.push(t);for(let r=0;r<t.children.length;r++)e.push(...getBoneList(t.children[r]));return e}export{SkeletonHelper};
//# sourceMappingURL=SkeletonHelper.js.map