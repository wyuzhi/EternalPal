import{Cache}from"./Cache.js";import{Loader}from"./Loader.js";const _errorMap=new WeakMap;class ImageBitmapLoader extends Loader{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,r,a){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,n=Cache.get(`image-bitmap:${e}`);if(void 0!==n)return o.manager.itemStart(e),n.then?void n.then((r=>{if(!0!==_errorMap.has(n))return t&&t(r),o.manager.itemEnd(e),r;a&&a(_errorMap.get(n)),o.manager.itemError(e),o.manager.itemEnd(e)})):(setTimeout((function(){t&&t(n),o.manager.itemEnd(e)}),0),n);const i={};i.credentials="anonymous"===this.crossOrigin?"same-origin":"include",i.headers=this.requestHeader,i.signal="function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const s=fetch(e,i).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(o.options,{colorSpaceConversion:"none"}))})).then((function(r){return Cache.add(`image-bitmap:${e}`,r),t&&t(r),o.manager.itemEnd(e),r})).catch((function(t){a&&a(t),_errorMap.set(s,t),Cache.remove(`image-bitmap:${e}`),o.manager.itemError(e),o.manager.itemEnd(e)}));Cache.add(`image-bitmap:${e}`,s),o.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}export{ImageBitmapLoader};
//# sourceMappingURL=ImageBitmapLoader.js.map