import Node from"../core/Node.js";import{NodeUpdateType}from"../core/constants.js";import{uniform}from"../core/UniformNode.js";import{texture}from"./TextureNode.js";import{cubeTexture}from"./CubeTextureNode.js";import{buffer}from"./BufferNode.js";import{nodeObject}from"../tsl/TSLBase.js";import{uniformArray}from"./UniformArrayNode.js";import ArrayElementNode from"../utils/ArrayElementNode.js";class ReferenceElementNode extends ArrayElementNode{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),o=this.getNodeType();return e.format(t,r,o)}}class ReferenceNode extends Node{static get type(){return"ReferenceNode"}constructor(e,t,r=null,o=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=o,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.name=null,this.updateType=NodeUpdateType.OBJECT}element(e){return nodeObject(new ReferenceElementNode(this,nodeObject(e)))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return console.warn('THREE.TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;t=null!==this.count?buffer(null,e,this.count):Array.isArray(this.getValueFromReference())?uniformArray(null,e):"texture"===e?texture(null):"cubeTexture"===e?cubeTexture(null):uniform(null,e),null!==this.group&&t.setGroup(this.group),null!==this.name&&t.setName(this.name),this.node=t.getSelf()}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let e=1;e<t.length;e++)r=r[t[e]];return r}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}export default ReferenceNode;export const reference=(e,t,r)=>nodeObject(new ReferenceNode(e,t,r));export const referenceBuffer=(e,t,r,o)=>nodeObject(new ReferenceNode(e,t,o,r));
//# sourceMappingURL=ReferenceNode.js.map