import Node from"../core/Node.js";import{NodeUpdateType}from"../core/constants.js";import{uniform}from"../core/UniformNode.js";import{Fn,nodeImmutable,vec2}from"../tsl/TSLBase.js";import{Vector2}from"../../math/Vector2.js";import{Vector4}from"../../math/Vector4.js";let screenSizeVec,viewportVec;class ScreenNode extends Node{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===ScreenNode.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=NodeUpdateType.NONE;return this.scope!==ScreenNode.SIZE&&this.scope!==ScreenNode.VIEWPORT||(e=NodeUpdateType.RENDER),this.updateType=e,e}update({renderer:e}){const o=e.getRenderTarget();this.scope===ScreenNode.VIEWPORT?null!==o?viewportVec.copy(o.viewport):(e.getViewport(viewportVec),viewportVec.multiplyScalar(e.getPixelRatio())):null!==o?(screenSizeVec.width=o.width,screenSizeVec.height=o.height):e.getDrawingBufferSize(screenSizeVec)}setup(){const e=this.scope;let o=null;return o=e===ScreenNode.SIZE?uniform(screenSizeVec||(screenSizeVec=new Vector2)):e===ScreenNode.VIEWPORT?uniform(viewportVec||(viewportVec=new Vector4)):vec2(screenCoordinate.div(screenSize)),o}generate(e){if(this.scope===ScreenNode.COORDINATE){let o=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(screenSize).outputNode.build(e);o=`${e.getType("vec2")}( ${o}.x, ${r}.y - ${o}.y )`}return o}return super.generate(e)}}ScreenNode.COORDINATE="coordinate",ScreenNode.VIEWPORT="viewport",ScreenNode.SIZE="size",ScreenNode.UV="uv";export default ScreenNode;export const screenUV=nodeImmutable(ScreenNode,ScreenNode.UV);export const screenSize=nodeImmutable(ScreenNode,ScreenNode.SIZE);export const screenCoordinate=nodeImmutable(ScreenNode,ScreenNode.COORDINATE);export const viewport=nodeImmutable(ScreenNode,ScreenNode.VIEWPORT);export const viewportSize=viewport.zw;export const viewportCoordinate=screenCoordinate.sub(viewport.xy);export const viewportUV=viewportCoordinate.div(viewportSize);export const viewportResolution=Fn((()=>(console.warn('THREE.TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),screenSize)),"vec2").once()();
//# sourceMappingURL=ScreenNode.js.map