import{DoubleSide}from"../../constants.js";function painterSortStable(e,r){return e.groupOrder!==r.groupOrder?e.groupOrder-r.groupOrder:e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?e.z-r.z:e.id-r.id}function reversePainterSortStable(e,r){return e.groupOrder!==r.groupOrder?e.groupOrder-r.groupOrder:e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id-r.id}function needsDoublePass(e){return(e.transmission>0||e.transmissionNode)&&e.side===DoubleSide&&!1===e.forceSinglePass}class RenderList{constructor(e,r,t){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(r,t),this.lightsArray=[],this.scene=r,this.camera=t,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,r,t,s,n,i,d){let o=this.renderItems[this.renderItemsIndex];return void 0===o?(o={id:e.id,object:e,geometry:r,material:t,groupOrder:s,renderOrder:e.renderOrder,z:n,group:i,clippingContext:d},this.renderItems[this.renderItemsIndex]=o):(o.id=e.id,o.object=e,o.geometry=r,o.material=t,o.groupOrder=s,o.renderOrder=e.renderOrder,o.z=n,o.group=i,o.clippingContext=d),this.renderItemsIndex++,o}push(e,r,t,s,n,i,d){const o=this.getNextRenderItem(e,r,t,s,n,i,d);!0===e.occlusionTest&&this.occlusionQueryCount++,!0===t.transparent||t.transmission>0?(needsDoublePass(t)&&this.transparentDoublePass.push(o),this.transparent.push(o)):this.opaque.push(o)}unshift(e,r,t,s,n,i,d){const o=this.getNextRenderItem(e,r,t,s,n,i,d);!0===t.transparent||t.transmission>0?(needsDoublePass(t)&&this.transparentDoublePass.unshift(o),this.transparent.unshift(o)):this.opaque.unshift(o)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,r){this.opaque.length>1&&this.opaque.sort(e||painterSortStable),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(r||reversePainterSortStable),this.transparent.length>1&&this.transparent.sort(r||reversePainterSortStable)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,r=this.renderItems.length;e<r;e++){const r=this.renderItems[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.groupOrder=null,r.renderOrder=null,r.z=null,r.group=null,r.clippingContext=null}}}export default RenderList;
//# sourceMappingURL=RenderList.js.map