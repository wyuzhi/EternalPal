{"version":3,"file":"node_modules/three/src/renderers/webgl/WebGLClipping.js","names":["Matrix3","Plane","WebGLClipping","properties","scope","this","globalState","numGlobalPlanes","localClippingEnabled","renderingShadows","plane","viewNormalMatrix","uniform","value","needsUpdate","projectPlanes","planes","camera","dstOffset","skipTransform","nPlanes","length","dstArray","flatSize","viewMatrix","matrixWorldInverse","getNormalMatrix","Float32Array","i","i4","copy","applyMatrix4","normal","toArray","constant","numPlanes","numIntersection","init","enableLocalClipping","enabled","beginShadows","endShadows","setGlobalState","setState","material","useCache","clippingPlanes","clipIntersection","clipShadows","materialProperties","get","resetGlobalState","nGlobal","lGlobal","clippingState"],"sources":["node_modules/three/src/renderers/webgl/WebGLClipping.js"],"sourcesContent":["import { Matrix3 } from '../../math/Matrix3.js';\nimport { Plane } from '../../math/Plane.js';\n\nfunction WebGLClipping( properties ) {\n\n\tconst scope = this;\n\n\tlet globalState = null,\n\t\tnumGlobalPlanes = 0,\n\t\tlocalClippingEnabled = false,\n\t\trenderingShadows = false;\n\n\tconst plane = new Plane(),\n\t\tviewNormalMatrix = new Matrix3(),\n\n\t\tuniform = { value: null, needsUpdate: false };\n\n\tthis.uniform = uniform;\n\tthis.numPlanes = 0;\n\tthis.numIntersection = 0;\n\n\tthis.init = function ( planes, enableLocalClipping ) {\n\n\t\tconst enabled =\n\t\t\tplanes.length !== 0 ||\n\t\t\tenableLocalClipping ||\n\t\t\t// enable state of previous frame - the clipping code has to\n\t\t\t// run another frame in order to reset the state:\n\t\t\tnumGlobalPlanes !== 0 ||\n\t\t\tlocalClippingEnabled;\n\n\t\tlocalClippingEnabled = enableLocalClipping;\n\n\t\tnumGlobalPlanes = planes.length;\n\n\t\treturn enabled;\n\n\t};\n\n\tthis.beginShadows = function () {\n\n\t\trenderingShadows = true;\n\t\tprojectPlanes( null );\n\n\t};\n\n\tthis.endShadows = function () {\n\n\t\trenderingShadows = false;\n\n\t};\n\n\tthis.setGlobalState = function ( planes, camera ) {\n\n\t\tglobalState = projectPlanes( planes, camera, 0 );\n\n\t};\n\n\tthis.setState = function ( material, camera, useCache ) {\n\n\t\tconst planes = material.clippingPlanes,\n\t\t\tclipIntersection = material.clipIntersection,\n\t\t\tclipShadows = material.clipShadows;\n\n\t\tconst materialProperties = properties.get( material );\n\n\t\tif ( ! localClippingEnabled || planes === null || planes.length === 0 || renderingShadows && ! clipShadows ) {\n\n\t\t\t// there's no local clipping\n\n\t\t\tif ( renderingShadows ) {\n\n\t\t\t\t// there's no global clipping\n\n\t\t\t\tprojectPlanes( null );\n\n\t\t\t} else {\n\n\t\t\t\tresetGlobalState();\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst nGlobal = renderingShadows ? 0 : numGlobalPlanes,\n\t\t\t\tlGlobal = nGlobal * 4;\n\n\t\t\tlet dstArray = materialProperties.clippingState || null;\n\n\t\t\tuniform.value = dstArray; // ensure unique state\n\n\t\t\tdstArray = projectPlanes( planes, camera, lGlobal, useCache );\n\n\t\t\tfor ( let i = 0; i !== lGlobal; ++ i ) {\n\n\t\t\t\tdstArray[ i ] = globalState[ i ];\n\n\t\t\t}\n\n\t\t\tmaterialProperties.clippingState = dstArray;\n\t\t\tthis.numIntersection = clipIntersection ? this.numPlanes : 0;\n\t\t\tthis.numPlanes += nGlobal;\n\n\t\t}\n\n\n\t};\n\n\tfunction resetGlobalState() {\n\n\t\tif ( uniform.value !== globalState ) {\n\n\t\t\tuniform.value = globalState;\n\t\t\tuniform.needsUpdate = numGlobalPlanes > 0;\n\n\t\t}\n\n\t\tscope.numPlanes = numGlobalPlanes;\n\t\tscope.numIntersection = 0;\n\n\t}\n\n\tfunction projectPlanes( planes, camera, dstOffset, skipTransform ) {\n\n\t\tconst nPlanes = planes !== null ? planes.length : 0;\n\t\tlet dstArray = null;\n\n\t\tif ( nPlanes !== 0 ) {\n\n\t\t\tdstArray = uniform.value;\n\n\t\t\tif ( skipTransform !== true || dstArray === null ) {\n\n\t\t\t\tconst flatSize = dstOffset + nPlanes * 4,\n\t\t\t\t\tviewMatrix = camera.matrixWorldInverse;\n\n\t\t\t\tviewNormalMatrix.getNormalMatrix( viewMatrix );\n\n\t\t\t\tif ( dstArray === null || dstArray.length < flatSize ) {\n\n\t\t\t\t\tdstArray = new Float32Array( flatSize );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0, i4 = dstOffset; i !== nPlanes; ++ i, i4 += 4 ) {\n\n\t\t\t\t\tplane.copy( planes[ i ] ).applyMatrix4( viewMatrix, viewNormalMatrix );\n\n\t\t\t\t\tplane.normal.toArray( dstArray, i4 );\n\t\t\t\t\tdstArray[ i4 + 3 ] = plane.constant;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tuniform.value = dstArray;\n\t\t\tuniform.needsUpdate = true;\n\n\t\t}\n\n\t\tscope.numPlanes = nPlanes;\n\t\tscope.numIntersection = 0;\n\n\t\treturn dstArray;\n\n\t}\n\n}\n\n\nexport { WebGLClipping };\n"],"mappings":"OAASA,YAAe,+BACfC,UAAa,sBAEtB,SAASC,cAAeC,GAEvB,MAAMC,EAAQC,KAEd,IAAIC,EAAc,KACjBC,EAAkB,EAClBC,GAAuB,EACvBC,GAAmB,EAEpB,MAAMC,EAAQ,IAAIT,MACjBU,EAAmB,IAAIX,QAEvBY,EAAU,CAAEC,MAAO,KAAMC,aAAa,GA2GvC,SAASC,EAAeC,EAAQC,EAAQC,EAAWC,GAElD,MAAMC,EAAqB,OAAXJ,EAAkBA,EAAOK,OAAS,EAClD,IAAIC,EAAW,KAEf,GAAiB,IAAZF,EAAgB,CAIpB,GAFAE,EAAWV,EAAQC,OAEI,IAAlBM,GAAuC,OAAbG,EAAoB,CAElD,MAAMC,EAAWL,EAAsB,EAAVE,EAC5BI,EAAaP,EAAOQ,mBAErBd,EAAiBe,gBAAiBF,IAEhB,OAAbF,GAAqBA,EAASD,OAASE,KAE3CD,EAAW,IAAIK,aAAcJ,IAI9B,IAAM,IAAIK,EAAI,EAAGC,EAAKX,EAAWU,IAAMR,IAAYQ,EAAGC,GAAM,EAE3DnB,EAAMoB,KAAMd,EAAQY,IAAMG,aAAcP,EAAYb,GAEpDD,EAAMsB,OAAOC,QAASX,EAAUO,GAChCP,EAAUO,EAAK,GAAMnB,EAAMwB,QAI7B,CAEAtB,EAAQC,MAAQS,EAChBV,EAAQE,aAAc,CAEvB,CAKA,OAHAV,EAAM+B,UAAYf,EAClBhB,EAAMgC,gBAAkB,EAEjBd,CAER,CApJAjB,KAAKO,QAAUA,EACfP,KAAK8B,UAAY,EACjB9B,KAAK+B,gBAAkB,EAEvB/B,KAAKgC,KAAO,SAAWrB,EAAQsB,GAE9B,MAAMC,EACa,IAAlBvB,EAAOK,QACPiB,GAGoB,IAApB/B,GACAC,EAMD,OAJAA,EAAuB8B,EAEvB/B,EAAkBS,EAAOK,OAElBkB,CAER,EAEAlC,KAAKmC,aAAe,WAEnB/B,GAAmB,EACnBM,EAAe,KAEhB,EAEAV,KAAKoC,WAAa,WAEjBhC,GAAmB,CAEpB,EAEAJ,KAAKqC,eAAiB,SAAW1B,EAAQC,GAExCX,EAAcS,EAAeC,EAAQC,EAAQ,EAE9C,EAEAZ,KAAKsC,SAAW,SAAWC,EAAU3B,EAAQ4B,GAE5C,MAAM7B,EAAS4B,EAASE,eACvBC,EAAmBH,EAASG,iBAC5BC,EAAcJ,EAASI,YAElBC,EAAqB9C,EAAW+C,IAAKN,GAE3C,IAAOpC,GAAmC,OAAXQ,GAAqC,IAAlBA,EAAOK,QAAgBZ,IAAsBuC,EAIzFvC,EAIJM,EAAe,MAkClB,WAEMH,EAAQC,QAAUP,IAEtBM,EAAQC,MAAQP,EAChBM,EAAQE,YAAcP,EAAkB,GAIzCH,EAAM+B,UAAY5B,EAClBH,EAAMgC,gBAAkB,CAEzB,CA1CGe,OAIK,CAEN,MAAMC,EAAU3C,EAAmB,EAAIF,EACtC8C,EAAoB,EAAVD,EAEX,IAAI9B,EAAW2B,EAAmBK,eAAiB,KAEnD1C,EAAQC,MAAQS,EAEhBA,EAAWP,EAAeC,EAAQC,EAAQoC,EAASR,GAEnD,IAAM,IAAIjB,EAAI,EAAGA,IAAMyB,IAAYzB,EAElCN,EAAUM,GAAMtB,EAAasB,GAI9BqB,EAAmBK,cAAgBhC,EACnCjB,KAAK+B,gBAAkBW,EAAmB1C,KAAK8B,UAAY,EAC3D9B,KAAK8B,WAAaiB,CAEnB,CAGD,CA6DD,QAGSlD","ignoreList":[]}