{"version":3,"file":"node_modules/three/src/renderers/webgl/WebGLCubeUVMaps.js","names":["CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","PMREMGenerator","WebGLCubeUVMaps","renderer","cubeUVmaps","WeakMap","pmremGenerator","onTextureDispose","event","texture","target","removeEventListener","cubemapUV","get","undefined","delete","dispose","isTexture","mapping","isEquirectMap","isCubeMap","renderTarget","currentPMREMVersion","pmremVersion","isRenderTargetTexture","fromEquirectangular","fromCubemap","set","image","height","count","length","i","isCubeTextureComplete","addEventListener"],"sources":["node_modules/three/src/renderers/webgl/WebGLCubeUVMaps.js"],"sourcesContent":["import { CubeReflectionMapping, CubeRefractionMapping, EquirectangularReflectionMapping, EquirectangularRefractionMapping } from '../../constants.js';\nimport { PMREMGenerator } from '../../extras/PMREMGenerator.js';\n\nfunction WebGLCubeUVMaps( renderer ) {\n\n\tlet cubeUVmaps = new WeakMap();\n\n\tlet pmremGenerator = null;\n\n\tfunction get( texture ) {\n\n\t\tif ( texture && texture.isTexture ) {\n\n\t\t\tconst mapping = texture.mapping;\n\n\t\t\tconst isEquirectMap = ( mapping === EquirectangularReflectionMapping || mapping === EquirectangularRefractionMapping );\n\t\t\tconst isCubeMap = ( mapping === CubeReflectionMapping || mapping === CubeRefractionMapping );\n\n\t\t\t// equirect/cube map to cubeUV conversion\n\n\t\t\tif ( isEquirectMap || isCubeMap ) {\n\n\t\t\t\tlet renderTarget = cubeUVmaps.get( texture );\n\n\t\t\t\tconst currentPMREMVersion = renderTarget !== undefined ? renderTarget.texture.pmremVersion : 0;\n\n\t\t\t\tif ( texture.isRenderTargetTexture && texture.pmremVersion !== currentPMREMVersion ) {\n\n\t\t\t\t\tif ( pmremGenerator === null ) pmremGenerator = new PMREMGenerator( renderer );\n\n\t\t\t\t\trenderTarget = isEquirectMap ? pmremGenerator.fromEquirectangular( texture, renderTarget ) : pmremGenerator.fromCubemap( texture, renderTarget );\n\t\t\t\t\trenderTarget.texture.pmremVersion = texture.pmremVersion;\n\n\t\t\t\t\tcubeUVmaps.set( texture, renderTarget );\n\n\t\t\t\t\treturn renderTarget.texture;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( renderTarget !== undefined ) {\n\n\t\t\t\t\t\treturn renderTarget.texture;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconst image = texture.image;\n\n\t\t\t\t\t\tif ( ( isEquirectMap && image && image.height > 0 ) || ( isCubeMap && image && isCubeTextureComplete( image ) ) ) {\n\n\t\t\t\t\t\t\tif ( pmremGenerator === null ) pmremGenerator = new PMREMGenerator( renderer );\n\n\t\t\t\t\t\t\trenderTarget = isEquirectMap ? pmremGenerator.fromEquirectangular( texture ) : pmremGenerator.fromCubemap( texture );\n\t\t\t\t\t\t\trenderTarget.texture.pmremVersion = texture.pmremVersion;\n\n\t\t\t\t\t\t\tcubeUVmaps.set( texture, renderTarget );\n\n\t\t\t\t\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\n\n\t\t\t\t\t\t\treturn renderTarget.texture;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// image not yet ready. try the conversion next frame\n\n\t\t\t\t\t\t\treturn null;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn texture;\n\n\t}\n\n\tfunction isCubeTextureComplete( image ) {\n\n\t\tlet count = 0;\n\t\tconst length = 6;\n\n\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\tif ( image[ i ] !== undefined ) count ++;\n\n\t\t}\n\n\t\treturn count === length;\n\n\n\t}\n\n\tfunction onTextureDispose( event ) {\n\n\t\tconst texture = event.target;\n\n\t\ttexture.removeEventListener( 'dispose', onTextureDispose );\n\n\t\tconst cubemapUV = cubeUVmaps.get( texture );\n\n\t\tif ( cubemapUV !== undefined ) {\n\n\t\t\tcubeUVmaps.delete( texture );\n\t\t\tcubemapUV.dispose();\n\n\t\t}\n\n\t}\n\n\tfunction dispose() {\n\n\t\tcubeUVmaps = new WeakMap();\n\n\t\tif ( pmremGenerator !== null ) {\n\n\t\t\tpmremGenerator.dispose();\n\t\t\tpmremGenerator = null;\n\n\t\t}\n\n\t}\n\n\treturn {\n\t\tget: get,\n\t\tdispose: dispose\n\t};\n\n}\n\nexport { WebGLCubeUVMaps };\n"],"mappings":"OAASA,sBAAuBC,sBAAuBC,iCAAkCC,qCAAwC,4BACxHC,mBAAsB,iCAE/B,SAASC,gBAAiBC,GAEzB,IAAIC,EAAa,IAAIC,QAEjBC,EAAiB,KAyFrB,SAASC,EAAkBC,GAE1B,MAAMC,EAAUD,EAAME,OAEtBD,EAAQE,oBAAqB,UAAWJ,GAExC,MAAMK,EAAYR,EAAWS,IAAKJ,QAEfK,IAAdF,IAEJR,EAAWW,OAAQN,GACnBG,EAAUI,UAIZ,CAeA,MAAO,CACNH,IAtHD,SAAcJ,GAEb,GAAKA,GAAWA,EAAQQ,UAAY,CAEnC,MAAMC,EAAUT,EAAQS,QAElBC,EAAkBD,IAAYnB,kCAAoCmB,IAAYlB,iCAC9EoB,EAAcF,IAAYrB,uBAAyBqB,IAAYpB,sBAIrE,GAAKqB,GAAiBC,EAAY,CAEjC,IAAIC,EAAejB,EAAWS,IAAKJ,GAEnC,MAAMa,OAAuCR,IAAjBO,EAA6BA,EAAaZ,QAAQc,aAAe,EAE7F,GAAKd,EAAQe,uBAAyBf,EAAQc,eAAiBD,EAS9D,OAPwB,OAAnBhB,IAA0BA,EAAiB,IAAIL,eAAgBE,IAEpEkB,EAAeF,EAAgBb,EAAemB,oBAAqBhB,EAASY,GAAiBf,EAAeoB,YAAajB,EAASY,GAClIA,EAAaZ,QAAQc,aAAed,EAAQc,aAE5CnB,EAAWuB,IAAKlB,EAASY,GAElBA,EAAaZ,QAIpB,QAAsBK,IAAjBO,EAEJ,OAAOA,EAAaZ,QAEd,CAEN,MAAMmB,EAAQnB,EAAQmB,MAEtB,OAAOT,GAAiBS,GAASA,EAAMC,OAAS,GAAST,GAAaQ,GAiC3E,SAAgCA,GAE/B,IAAIE,EAAQ,EACZ,MAAMC,EAAS,EAEf,IAAM,IAAIC,EAAI,EAAGA,EAAID,EAAQC,SAERlB,IAAfc,EAAOI,IAAoBF,IAIjC,OAAOA,IAAUC,CAGlB,CA/CoFE,CAAuBL,IAE7E,OAAnBtB,IAA0BA,EAAiB,IAAIL,eAAgBE,IAEpEkB,EAAeF,EAAgBb,EAAemB,oBAAqBhB,GAAYH,EAAeoB,YAAajB,GAC3GY,EAAaZ,QAAQc,aAAed,EAAQc,aAE5CnB,EAAWuB,IAAKlB,EAASY,GAEzBZ,EAAQyB,iBAAkB,UAAW3B,GAE9Bc,EAAaZ,SAMb,IAIT,CAIF,CAED,CAEA,OAAOA,CAER,EAkDCO,QAfD,WAECZ,EAAa,IAAIC,QAEO,OAAnBC,IAEJA,EAAeU,UACfV,EAAiB,KAInB,EAOD,QAESJ","ignoreList":[]}