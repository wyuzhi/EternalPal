import{NotEqualDepth,GreaterDepth,GreaterEqualDepth,EqualDepth,LessEqualDepth,LessDepth,AlwaysDepth,NeverDepth,CullFaceFront,CullFaceBack,CullFaceNone,DoubleSide,BackSide,CustomBlending,MultiplyBlending,SubtractiveBlending,AdditiveBlending,NoBlending,NormalBlending,AddEquation,SubtractEquation,ReverseSubtractEquation,MinEquation,MaxEquation,ZeroFactor,OneFactor,SrcColorFactor,SrcAlphaFactor,SrcAlphaSaturateFactor,DstColorFactor,DstAlphaFactor,OneMinusSrcColorFactor,OneMinusSrcAlphaFactor,OneMinusDstColorFactor,OneMinusDstAlphaFactor,ConstantColorFactor,OneMinusConstantColorFactor,ConstantAlphaFactor,OneMinusConstantAlphaFactor}from"../../constants.js";import{Color}from"../../math/Color.js";import{Vector4}from"../../math/Vector4.js";const reversedFuncs={[NeverDepth]:AlwaysDepth,[LessDepth]:GreaterDepth,[EqualDepth]:NotEqualDepth,[LessEqualDepth]:GreaterEqualDepth,[AlwaysDepth]:NeverDepth,[GreaterDepth]:LessDepth,[NotEqualDepth]:EqualDepth,[GreaterEqualDepth]:LessEqualDepth};function WebGLState(e,t){const n=new function(){let t=!1;const n=new Vector4;let l=null;const a=new Vector4(0,0,0,0);return{setMask:function(n){l===n||t||(e.colorMask(n,n,n,n),l=n)},setLocked:function(e){t=e},setClear:function(t,l,r,o,c){!0===c&&(t*=o,l*=o,r*=o),n.set(t,l,r,o),!1===a.equals(n)&&(e.clearColor(t,l,r,o),a.copy(n))},reset:function(){t=!1,l=null,a.set(-1,0,0,0)}}},l=new function(){let n=!1,l=!1,a=null,r=null,o=null;return{setReversed:function(e){if(l!==e){const n=t.get("EXT_clip_control");e?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),l=e;const a=o;o=null,this.setClear(a)}},getReversed:function(){return l},setTest:function(t){t?W(e.DEPTH_TEST):y(e.DEPTH_TEST)},setMask:function(t){a===t||n||(e.depthMask(t),a=t)},setFunc:function(t){if(l&&(t=reversedFuncs[t]),r!==t){switch(t){case NeverDepth:e.depthFunc(e.NEVER);break;case AlwaysDepth:e.depthFunc(e.ALWAYS);break;case LessDepth:e.depthFunc(e.LESS);break;case LessEqualDepth:e.depthFunc(e.LEQUAL);break;case EqualDepth:e.depthFunc(e.EQUAL);break;case GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case GreaterDepth:e.depthFunc(e.GREATER);break;case NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}r=t}},setLocked:function(e){n=e},setClear:function(t){o!==t&&(l&&(t=1-t),e.clearDepth(t),o=t)},reset:function(){n=!1,a=null,r=null,o=null,l=!1}}},a=new function(){let t=!1,n=null,l=null,a=null,r=null,o=null,c=null,u=null,s=null;return{setTest:function(n){t||(n?W(e.STENCIL_TEST):y(e.STENCIL_TEST))},setMask:function(l){n===l||t||(e.stencilMask(l),n=l)},setFunc:function(t,n,o){l===t&&a===n&&r===o||(e.stencilFunc(t,n,o),l=t,a=n,r=o)},setOp:function(t,n,l){o===t&&c===n&&u===l||(e.stencilOp(t,n,l),o=t,c=n,u=l)},setLocked:function(e){t=e},setClear:function(t){s!==t&&(e.clearStencil(t),s=t)},reset:function(){t=!1,n=null,l=null,a=null,r=null,o=null,c=null,u=null,s=null}}},r=new WeakMap,o=new WeakMap;let c={},u={},s=new WeakMap,i=[],E=null,d=!1,T=null,S=null,A=null,p=null,_=null,F=null,R=null,C=new Color(0,0,0),O=0,f=!1,h=null,b=null,L=null,D=null,N=null;const g=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let M=!1,U=0;const m=e.getParameter(e.VERSION);-1!==m.indexOf("WebGL")?(U=parseFloat(/^WebGL (\d)/.exec(m)[1]),M=U>=1):-1!==m.indexOf("OpenGL ES")&&(U=parseFloat(/^OpenGL ES (\d)/.exec(m)[1]),M=U>=2);let B=null,I={};const x=e.getParameter(e.SCISSOR_BOX),v=e.getParameter(e.VIEWPORT),P=(new Vector4).fromArray(x),k=(new Vector4).fromArray(v);function G(t,n,l,a){const r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<l;o++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,r):e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r);return o}const q={};function W(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function y(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}q[e.TEXTURE_2D]=G(e.TEXTURE_2D,e.TEXTURE_2D,1),q[e.TEXTURE_CUBE_MAP]=G(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),q[e.TEXTURE_2D_ARRAY]=G(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),q[e.TEXTURE_3D]=G(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),l.setClear(1),a.setClear(0),W(e.DEPTH_TEST),l.setFunc(LessEqualDepth),V(!1),Z(CullFaceBack),W(e.CULL_FACE),X(NoBlending);const H={[AddEquation]:e.FUNC_ADD,[SubtractEquation]:e.FUNC_SUBTRACT,[ReverseSubtractEquation]:e.FUNC_REVERSE_SUBTRACT};H[MinEquation]=e.MIN,H[MaxEquation]=e.MAX;const w={[ZeroFactor]:e.ZERO,[OneFactor]:e.ONE,[SrcColorFactor]:e.SRC_COLOR,[SrcAlphaFactor]:e.SRC_ALPHA,[SrcAlphaSaturateFactor]:e.SRC_ALPHA_SATURATE,[DstColorFactor]:e.DST_COLOR,[DstAlphaFactor]:e.DST_ALPHA,[OneMinusSrcColorFactor]:e.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:e.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:e.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:e.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:e.CONSTANT_COLOR,[OneMinusConstantColorFactor]:e.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:e.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:e.ONE_MINUS_CONSTANT_ALPHA};function X(t,n,l,a,r,o,c,u,s,i){if(t!==NoBlending){if(!1===d&&(W(e.BLEND),d=!0),t===CustomBlending)r=r||n,o=o||l,c=c||a,n===S&&r===_||(e.blendEquationSeparate(H[n],H[r]),S=n,_=r),l===A&&a===p&&o===F&&c===R||(e.blendFuncSeparate(w[l],w[a],w[o],w[c]),A=l,p=a,F=o,R=c),!1!==u.equals(C)&&s===O||(e.blendColor(u.r,u.g,u.b,s),C.copy(u),O=s),T=t,f=!1;else if(t!==T||i!==f){if(S===AddEquation&&_===AddEquation||(e.blendEquation(e.FUNC_ADD),S=AddEquation,_=AddEquation),i)switch(t){case NormalBlending:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:e.blendFunc(e.ONE,e.ONE);break;case SubtractiveBlending:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case MultiplyBlending:e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case NormalBlending:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case SubtractiveBlending:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case MultiplyBlending:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}A=null,p=null,F=null,R=null,C.set(0,0,0),O=0,T=t,f=i}}else!0===d&&(y(e.BLEND),d=!1)}function V(t){h!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),h=t)}function Z(t){t!==CullFaceNone?(W(e.CULL_FACE),t!==b&&(t===CullFaceBack?e.cullFace(e.BACK):t===CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):y(e.CULL_FACE),b=t}function Y(t,n,l){t?(W(e.POLYGON_OFFSET_FILL),D===n&&N===l||(e.polygonOffset(n,l),D=n,N=l)):y(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:l,stencil:a},enable:W,disable:y,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let l=i,a=!1;if(t){l=s.get(n),void 0===l&&(l=[],s.set(n,l));const r=t.textures;if(l.length!==r.length||l[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=r.length;t<n;t++)l[t]=e.COLOR_ATTACHMENT0+t;l.length=r.length,a=!0}}else l[0]!==e.BACK&&(l[0]=e.BACK,a=!0);a&&e.drawBuffers(l)},useProgram:function(t){return E!==t&&(e.useProgram(t),E=t,!0)},setBlending:X,setMaterial:function(t,r){t.side===DoubleSide?y(e.CULL_FACE):W(e.CULL_FACE);let o=t.side===BackSide;r&&(o=!o),V(o),t.blending===NormalBlending&&!1===t.transparent?X(NoBlending):X(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),l.setFunc(t.depthFunc),l.setTest(t.depthTest),l.setMask(t.depthWrite),n.setMask(t.colorWrite);const c=t.stencilWrite;a.setTest(c),c&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Y(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?W(e.SAMPLE_ALPHA_TO_COVERAGE):y(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:V,setCullFace:Z,setLineWidth:function(t){t!==L&&(M&&e.lineWidth(t),L=t)},setPolygonOffset:Y,setScissorTest:function(t){t?W(e.SCISSOR_TEST):y(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+g-1),B!==t&&(e.activeTexture(t),B=t)},bindTexture:function(t,n,l){void 0===l&&(l=null===B?e.TEXTURE0+g-1:B);let a=I[l];void 0===a&&(a={type:void 0,texture:void 0},I[l]=a),a.type===t&&a.texture===n||(B!==l&&(e.activeTexture(l),B=l),e.bindTexture(t,n||q[t]),a.type=t,a.texture=n)},unbindTexture:function(){const t=I[B];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let l=o.get(n);void 0===l&&(l=new WeakMap,o.set(n,l));let a=l.get(t);void 0===a&&(a=e.getUniformBlockIndex(n,t.name),l.set(t,a))},uniformBlockBinding:function(t,n){const l=o.get(n).get(t);r.get(n)!==l&&(e.uniformBlockBinding(n,l,t.__bindingPointIndex),r.set(n,l))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===P.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),P.copy(t))},viewport:function(t){!1===k.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),k.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),l.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},B=null,I={},u={},s=new WeakMap,i=[],E=null,d=!1,T=null,S=null,A=null,p=null,_=null,F=null,R=null,C=new Color(0,0,0),O=0,f=!1,h=null,b=null,L=null,D=null,N=null,P.set(0,0,e.canvas.width,e.canvas.height),k.set(0,0,e.canvas.width,e.canvas.height),n.reset(),l.reset(),a.reset()}}}export{WebGLState};
//# sourceMappingURL=WebGLState.js.map