import{GPUTextureFormat,GPUAddressMode,GPUFilterMode,GPUTextureDimension,GPUFeatureName,GPUTextureViewDimension}from"./WebGPUConstants.js";import{ColorManagement}from"../../../math/ColorManagement.js";import WebGPUTexturePassUtils from"./WebGPUTexturePassUtils.js";import{ByteType,ShortType,NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,RepeatWrapping,MirroredRepeatWrapping,RGB_ETC2_Format,RGBA_ETC2_EAC_Format,RGBAFormat,RGBFormat,RedFormat,RGFormat,RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format,UnsignedByteType,FloatType,HalfFloatType,SRGBTransfer,DepthFormat,DepthStencilFormat,RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format,RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format,RGBA_ASTC_10x10_Format,RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format,UnsignedIntType,UnsignedShortType,UnsignedInt248Type,UnsignedInt5999Type,NeverCompare,AlwaysCompare,LessCompare,LessEqualCompare,EqualCompare,GreaterEqualCompare,GreaterCompare,NotEqualCompare,IntType,RedIntegerFormat,RGIntegerFormat,RGBAIntegerFormat}from"../../../constants.js";import{CubeTexture}from"../../../textures/CubeTexture.js";import{DepthTexture}from"../../../textures/DepthTexture.js";import{Texture}from"../../../textures/Texture.js";const _compareToWebGPU={[NeverCompare]:"never",[LessCompare]:"less",[EqualCompare]:"equal",[LessEqualCompare]:"less-equal",[GreaterCompare]:"greater",[GreaterEqualCompare]:"greater-equal",[AlwaysCompare]:"always",[NotEqualCompare]:"not-equal"},_flipMap=[0,1,3,2,4,5];class WebGPUTextureUtils{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new DepthTexture,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,r=t.device,a=t.get(e),o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===GPUFilterMode.Linear&&o.minFilter===GPUFilterMode.Linear&&o.mipmapFilter===GPUFilterMode.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&null!==e.compareFunction&&(o.compare=_compareToWebGPU[e.compareFunction]),a.sampler=r.createSampler(o)}createDefaultTexture(e){let t;const r=getFormat(e);t=e.isCubeTexture?this._getDefaultCubeTextureGPU(r):this._getDefaultTextureGPU(r),this.backend.get(e).texture=t}createTexture(e,t={}){const r=this.backend,a=r.get(e);if(a.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");void 0===t.needsMipmaps&&(t.needsMipmaps=!1),void 0===t.levels&&(t.levels=1),void 0===t.depth&&(t.depth=1);const{width:o,height:n,depth:m,levels:i}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const T=this._getDimension(e),G=e.internalFormat||t.format||getFormat(e,r.device);a.format=G;const{samples:u,primarySamples:s,isMSAA:U}=r.utils.getTextureSampleData(e);let x=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===e.isStorageTexture&&(x|=GPUTextureUsage.STORAGE_BINDING),!0!==e.isCompressedTexture&&!0!==e.isCompressedArrayTexture&&(x|=GPUTextureUsage.RENDER_ATTACHMENT);const F={label:e.name,size:{width:o,height:n,depthOrArrayLayers:m},mipLevelCount:i,sampleCount:s,dimension:T,format:G,usage:x};if(void 0===G)return console.warn("WebGPURenderer: Texture format not supported."),void this.createDefaultTexture(e);if(e.isCubeTexture&&(F.textureBindingViewDimension=GPUTextureViewDimension.Cube),a.texture=r.device.createTexture(F),U){const e=Object.assign({},F);e.label=e.label+"-msaa",e.sampleCount=u,a.msaaTexture=r.device.createTexture(e)}a.initialized=!0,a.textureDescriptorGPU=F}destroyTexture(e){const t=this.backend,r=t.get(e);void 0!==r.texture&&r.texture.destroy(),void 0!==r.msaaTexture&&r.msaaTexture.destroy(),t.delete(e)}destroySampler(e){delete this.backend.get(e).sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let e=0;e<6;e++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,e);else{const r=e.image.depth||1;for(let e=0;e<r;e++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,e)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:r}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const r=this.backend,{width:a,height:o}=r.getDrawingBufferSize(),n=this.depthTexture,m=r.get(n).texture;let i,T;if(t?(i=DepthStencilFormat,T=UnsignedInt248Type):e&&(i=DepthFormat,T=UnsignedIntType),void 0!==m){if(n.image.width===a&&n.image.height===o&&n.format===i&&n.type===T)return m;this.destroyTexture(n)}return n.name="depthBuffer",n.format=i,n.type=T,n.image.width=a,n.image.height=o,this.createTexture(n,{width:a,height:o}),r.get(n).texture}updateTexture(e,t){const r=this.backend.get(e),{textureDescriptorGPU:a}=r;if(!e.isRenderTargetTexture&&void 0!==a){if(e.isDataTexture)this._copyBufferToTexture(t.image,r.texture,a,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,r.texture,a,o,e.flipY,o);else e.isCompressedTexture||e.isCompressedArrayTexture?this._copyCompressedBufferToTexture(e.mipmaps,r.texture,a):e.isCubeTexture?this._copyCubeMapToTexture(t.images,r.texture,a,e.flipY,e.premultiplyAlpha):this._copyImageToTexture(t.image,r.texture,a,0,e.flipY,e.premultiplyAlpha);r.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,r,a,o,n){const m=this.backend.device,i=this.backend.get(e),T=i.texture,G=i.textureDescriptorGPU.format,u=this._getBytesPerTexel(G);let s=a*u;s=256*Math.ceil(s/256);const U=m.createBuffer({size:a*o*u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),x=m.createCommandEncoder();x.copyTextureToBuffer({texture:T,origin:{x:t,y:r,z:n}},{buffer:U,bytesPerRow:s},{width:a,height:o});const F=this._getTypedArrayType(G);m.queue.submit([x.finish()]),await U.mapAsync(GPUMapMode.READ);return new F(U.getMappedRange())}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const r=new Texture;r.minFilter=NearestFilter,r.magFilter=NearestFilter,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const r=new CubeTexture;r.minFilter=NearestFilter,r.magFilter=NearestFilter,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=r}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,r,a,o){for(let n=0;n<6;n++){const m=e[n],i=!0===a?_flipMap[n]:n;m.isDataTexture?this._copyBufferToTexture(m.image,t,r,i,a):this._copyImageToTexture(m,t,r,i,a,o)}}_copyImageToTexture(e,t,r,a,o,n){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:o},{texture:t,mipLevel:0,origin:{x:0,y:0,z:a},premultipliedAlpha:n},{width:r.size.width,height:r.size.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return null===e&&(this._passUtils=e=new WebGPUTexturePassUtils(this.backend.device)),e}_generateMipmaps(e,t,r=0){this._getPassUtils().generateMipmaps(e,t,r)}_flipY(e,t,r=0){this._getPassUtils().flipY(e,t,r)}_copyBufferToTexture(e,t,r,a,o,n=0){const m=this.backend.device,i=e.data,T=this._getBytesPerTexel(r.format),G=e.width*T;m.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:a}},i,{offset:e.width*e.height*T*n,bytesPerRow:G},{width:e.width,height:e.height,depthOrArrayLayers:1}),!0===o&&this._flipY(t,r,a)}_copyCompressedBufferToTexture(e,t,r){const a=this.backend.device,o=this._getBlockData(r.format),n=r.size.depthOrArrayLayers>1;for(let m=0;m<e.length;m++){const i=e[m],T=i.width,G=i.height,u=n?r.size.depthOrArrayLayers:1,s=Math.ceil(T/o.width)*o.byteLength,U=s*Math.ceil(G/o.height);for(let e=0;e<u;e++)a.queue.writeTexture({texture:t,mipLevel:m,origin:{x:0,y:0,z:e}},i.data,{offset:e*U,bytesPerRow:s,rowsPerImage:Math.ceil(G/o.height)},{width:Math.ceil(T/o.width)*o.width,height:Math.ceil(G/o.height)*o.height,depthOrArrayLayers:1})}}_getBlockData(e){return e===GPUTextureFormat.BC1RGBAUnorm||e===GPUTextureFormat.BC1RGBAUnormSRGB?{byteLength:8,width:4,height:4}:e===GPUTextureFormat.BC2RGBAUnorm||e===GPUTextureFormat.BC2RGBAUnormSRGB||e===GPUTextureFormat.BC3RGBAUnorm||e===GPUTextureFormat.BC3RGBAUnormSRGB?{byteLength:16,width:4,height:4}:e===GPUTextureFormat.BC4RUnorm||e===GPUTextureFormat.BC4RSnorm?{byteLength:8,width:4,height:4}:e===GPUTextureFormat.BC5RGUnorm||e===GPUTextureFormat.BC5RGSnorm||e===GPUTextureFormat.BC6HRGBUFloat||e===GPUTextureFormat.BC6HRGBFloat||e===GPUTextureFormat.BC7RGBAUnorm||e===GPUTextureFormat.BC7RGBAUnormSRGB?{byteLength:16,width:4,height:4}:e===GPUTextureFormat.ETC2RGB8Unorm||e===GPUTextureFormat.ETC2RGB8UnormSRGB||e===GPUTextureFormat.ETC2RGB8A1Unorm||e===GPUTextureFormat.ETC2RGB8A1UnormSRGB?{byteLength:8,width:4,height:4}:e===GPUTextureFormat.ETC2RGBA8Unorm||e===GPUTextureFormat.ETC2RGBA8UnormSRGB?{byteLength:16,width:4,height:4}:e===GPUTextureFormat.EACR11Unorm||e===GPUTextureFormat.EACR11Snorm?{byteLength:8,width:4,height:4}:e===GPUTextureFormat.EACRG11Unorm||e===GPUTextureFormat.EACRG11Snorm||e===GPUTextureFormat.ASTC4x4Unorm||e===GPUTextureFormat.ASTC4x4UnormSRGB?{byteLength:16,width:4,height:4}:e===GPUTextureFormat.ASTC5x4Unorm||e===GPUTextureFormat.ASTC5x4UnormSRGB?{byteLength:16,width:5,height:4}:e===GPUTextureFormat.ASTC5x5Unorm||e===GPUTextureFormat.ASTC5x5UnormSRGB?{byteLength:16,width:5,height:5}:e===GPUTextureFormat.ASTC6x5Unorm||e===GPUTextureFormat.ASTC6x5UnormSRGB?{byteLength:16,width:6,height:5}:e===GPUTextureFormat.ASTC6x6Unorm||e===GPUTextureFormat.ASTC6x6UnormSRGB?{byteLength:16,width:6,height:6}:e===GPUTextureFormat.ASTC8x5Unorm||e===GPUTextureFormat.ASTC8x5UnormSRGB?{byteLength:16,width:8,height:5}:e===GPUTextureFormat.ASTC8x6Unorm||e===GPUTextureFormat.ASTC8x6UnormSRGB?{byteLength:16,width:8,height:6}:e===GPUTextureFormat.ASTC8x8Unorm||e===GPUTextureFormat.ASTC8x8UnormSRGB?{byteLength:16,width:8,height:8}:e===GPUTextureFormat.ASTC10x5Unorm||e===GPUTextureFormat.ASTC10x5UnormSRGB?{byteLength:16,width:10,height:5}:e===GPUTextureFormat.ASTC10x6Unorm||e===GPUTextureFormat.ASTC10x6UnormSRGB?{byteLength:16,width:10,height:6}:e===GPUTextureFormat.ASTC10x8Unorm||e===GPUTextureFormat.ASTC10x8UnormSRGB?{byteLength:16,width:10,height:8}:e===GPUTextureFormat.ASTC10x10Unorm||e===GPUTextureFormat.ASTC10x10UnormSRGB?{byteLength:16,width:10,height:10}:e===GPUTextureFormat.ASTC12x10Unorm||e===GPUTextureFormat.ASTC12x10UnormSRGB?{byteLength:16,width:12,height:10}:e===GPUTextureFormat.ASTC12x12Unorm||e===GPUTextureFormat.ASTC12x12UnormSRGB?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(e){let t=GPUAddressMode.ClampToEdge;return e===RepeatWrapping?t=GPUAddressMode.Repeat:e===MirroredRepeatWrapping&&(t=GPUAddressMode.MirrorRepeat),t}_convertFilterMode(e){let t=GPUFilterMode.Linear;return e!==NearestFilter&&e!==NearestMipmapNearestFilter&&e!==NearestMipmapLinearFilter||(t=GPUFilterMode.Nearest),t}_getBytesPerTexel(e){return e===GPUTextureFormat.R8Unorm||e===GPUTextureFormat.R8Snorm||e===GPUTextureFormat.R8Uint||e===GPUTextureFormat.R8Sint?1:e===GPUTextureFormat.R16Uint||e===GPUTextureFormat.R16Sint||e===GPUTextureFormat.R16Float||e===GPUTextureFormat.RG8Unorm||e===GPUTextureFormat.RG8Snorm||e===GPUTextureFormat.RG8Uint||e===GPUTextureFormat.RG8Sint?2:e===GPUTextureFormat.R32Uint||e===GPUTextureFormat.R32Sint||e===GPUTextureFormat.R32Float||e===GPUTextureFormat.RG16Uint||e===GPUTextureFormat.RG16Sint||e===GPUTextureFormat.RG16Float||e===GPUTextureFormat.RGBA8Unorm||e===GPUTextureFormat.RGBA8UnormSRGB||e===GPUTextureFormat.RGBA8Snorm||e===GPUTextureFormat.RGBA8Uint||e===GPUTextureFormat.RGBA8Sint||e===GPUTextureFormat.BGRA8Unorm||e===GPUTextureFormat.BGRA8UnormSRGB||e===GPUTextureFormat.RGB9E5UFloat||e===GPUTextureFormat.RGB10A2Unorm||e===GPUTextureFormat.RG11B10UFloat||e===GPUTextureFormat.Depth32Float||e===GPUTextureFormat.Depth24Plus||e===GPUTextureFormat.Depth24PlusStencil8||e===GPUTextureFormat.Depth32FloatStencil8?4:e===GPUTextureFormat.RG32Uint||e===GPUTextureFormat.RG32Sint||e===GPUTextureFormat.RG32Float||e===GPUTextureFormat.RGBA16Uint||e===GPUTextureFormat.RGBA16Sint||e===GPUTextureFormat.RGBA16Float?8:e===GPUTextureFormat.RGBA32Uint||e===GPUTextureFormat.RGBA32Sint||e===GPUTextureFormat.RGBA32Float?16:void 0}_getTypedArrayType(e){return e===GPUTextureFormat.R8Uint?Uint8Array:e===GPUTextureFormat.R8Sint?Int8Array:e===GPUTextureFormat.R8Unorm?Uint8Array:e===GPUTextureFormat.R8Snorm?Int8Array:e===GPUTextureFormat.RG8Uint?Uint8Array:e===GPUTextureFormat.RG8Sint?Int8Array:e===GPUTextureFormat.RG8Unorm?Uint8Array:e===GPUTextureFormat.RG8Snorm?Int8Array:e===GPUTextureFormat.RGBA8Uint?Uint8Array:e===GPUTextureFormat.RGBA8Sint?Int8Array:e===GPUTextureFormat.RGBA8Unorm?Uint8Array:e===GPUTextureFormat.RGBA8Snorm?Int8Array:e===GPUTextureFormat.R16Uint?Uint16Array:e===GPUTextureFormat.R16Sint?Int16Array:e===GPUTextureFormat.RG16Uint?Uint16Array:e===GPUTextureFormat.RG16Sint?Int16Array:e===GPUTextureFormat.RGBA16Uint?Uint16Array:e===GPUTextureFormat.RGBA16Sint?Int16Array:e===GPUTextureFormat.R16Float||e===GPUTextureFormat.RG16Float||e===GPUTextureFormat.RGBA16Float?Uint16Array:e===GPUTextureFormat.R32Uint?Uint32Array:e===GPUTextureFormat.R32Sint?Int32Array:e===GPUTextureFormat.R32Float?Float32Array:e===GPUTextureFormat.RG32Uint?Uint32Array:e===GPUTextureFormat.RG32Sint?Int32Array:e===GPUTextureFormat.RG32Float?Float32Array:e===GPUTextureFormat.RGBA32Uint?Uint32Array:e===GPUTextureFormat.RGBA32Sint?Int32Array:e===GPUTextureFormat.RGBA32Float?Float32Array:e===GPUTextureFormat.BGRA8Unorm||e===GPUTextureFormat.BGRA8UnormSRGB?Uint8Array:e===GPUTextureFormat.RGB10A2Unorm||e===GPUTextureFormat.RGB9E5UFloat||e===GPUTextureFormat.RG11B10UFloat?Uint32Array:e===GPUTextureFormat.Depth32Float?Float32Array:e===GPUTextureFormat.Depth24Plus||e===GPUTextureFormat.Depth24PlusStencil8?Uint32Array:e===GPUTextureFormat.Depth32FloatStencil8?Float32Array:void 0}_getDimension(e){let t;return t=e.is3DTexture||e.isData3DTexture?GPUTextureDimension.ThreeD:GPUTextureDimension.TwoD,t}}export function getFormat(e,t=null){const r=e.format,a=e.type,o=e.colorSpace,n=ColorManagement.getTransfer(o);let m;if(!0===e.isCompressedTexture||!0===e.isCompressedArrayTexture)switch(r){case RGBA_S3TC_DXT1_Format:m=n===SRGBTransfer?GPUTextureFormat.BC1RGBAUnormSRGB:GPUTextureFormat.BC1RGBAUnorm;break;case RGBA_S3TC_DXT3_Format:m=n===SRGBTransfer?GPUTextureFormat.BC2RGBAUnormSRGB:GPUTextureFormat.BC2RGBAUnorm;break;case RGBA_S3TC_DXT5_Format:m=n===SRGBTransfer?GPUTextureFormat.BC3RGBAUnormSRGB:GPUTextureFormat.BC3RGBAUnorm;break;case RGB_ETC2_Format:m=n===SRGBTransfer?GPUTextureFormat.ETC2RGB8UnormSRGB:GPUTextureFormat.ETC2RGB8Unorm;break;case RGBA_ETC2_EAC_Format:m=n===SRGBTransfer?GPUTextureFormat.ETC2RGBA8UnormSRGB:GPUTextureFormat.ETC2RGBA8Unorm;break;case RGBA_ASTC_4x4_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC4x4UnormSRGB:GPUTextureFormat.ASTC4x4Unorm;break;case RGBA_ASTC_5x4_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC5x4UnormSRGB:GPUTextureFormat.ASTC5x4Unorm;break;case RGBA_ASTC_5x5_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC5x5UnormSRGB:GPUTextureFormat.ASTC5x5Unorm;break;case RGBA_ASTC_6x5_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC6x5UnormSRGB:GPUTextureFormat.ASTC6x5Unorm;break;case RGBA_ASTC_6x6_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC6x6UnormSRGB:GPUTextureFormat.ASTC6x6Unorm;break;case RGBA_ASTC_8x5_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC8x5UnormSRGB:GPUTextureFormat.ASTC8x5Unorm;break;case RGBA_ASTC_8x6_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC8x6UnormSRGB:GPUTextureFormat.ASTC8x6Unorm;break;case RGBA_ASTC_8x8_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC8x8UnormSRGB:GPUTextureFormat.ASTC8x8Unorm;break;case RGBA_ASTC_10x5_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC10x5UnormSRGB:GPUTextureFormat.ASTC10x5Unorm;break;case RGBA_ASTC_10x6_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC10x6UnormSRGB:GPUTextureFormat.ASTC10x6Unorm;break;case RGBA_ASTC_10x8_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC10x8UnormSRGB:GPUTextureFormat.ASTC10x8Unorm;break;case RGBA_ASTC_10x10_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC10x10UnormSRGB:GPUTextureFormat.ASTC10x10Unorm;break;case RGBA_ASTC_12x10_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC12x10UnormSRGB:GPUTextureFormat.ASTC12x10Unorm;break;case RGBA_ASTC_12x12_Format:m=n===SRGBTransfer?GPUTextureFormat.ASTC12x12UnormSRGB:GPUTextureFormat.ASTC12x12Unorm;break;case RGBAFormat:m=n===SRGBTransfer?GPUTextureFormat.RGBA8UnormSRGB:GPUTextureFormat.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",r)}else switch(r){case RGBAFormat:switch(a){case ByteType:m=GPUTextureFormat.RGBA8Snorm;break;case ShortType:m=GPUTextureFormat.RGBA16Sint;break;case UnsignedShortType:m=GPUTextureFormat.RGBA16Uint;break;case UnsignedIntType:m=GPUTextureFormat.RGBA32Uint;break;case IntType:m=GPUTextureFormat.RGBA32Sint;break;case UnsignedByteType:m=n===SRGBTransfer?GPUTextureFormat.RGBA8UnormSRGB:GPUTextureFormat.RGBA8Unorm;break;case HalfFloatType:m=GPUTextureFormat.RGBA16Float;break;case FloatType:m=GPUTextureFormat.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",a)}break;case RGBFormat:if(a===UnsignedInt5999Type)m=GPUTextureFormat.RGB9E5UFloat;else console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",a);break;case RedFormat:switch(a){case ByteType:m=GPUTextureFormat.R8Snorm;break;case ShortType:m=GPUTextureFormat.R16Sint;break;case UnsignedShortType:m=GPUTextureFormat.R16Uint;break;case UnsignedIntType:m=GPUTextureFormat.R32Uint;break;case IntType:m=GPUTextureFormat.R32Sint;break;case UnsignedByteType:m=GPUTextureFormat.R8Unorm;break;case HalfFloatType:m=GPUTextureFormat.R16Float;break;case FloatType:m=GPUTextureFormat.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",a)}break;case RGFormat:switch(a){case ByteType:m=GPUTextureFormat.RG8Snorm;break;case ShortType:m=GPUTextureFormat.RG16Sint;break;case UnsignedShortType:m=GPUTextureFormat.RG16Uint;break;case UnsignedIntType:m=GPUTextureFormat.RG32Uint;break;case IntType:m=GPUTextureFormat.RG32Sint;break;case UnsignedByteType:m=GPUTextureFormat.RG8Unorm;break;case HalfFloatType:m=GPUTextureFormat.RG16Float;break;case FloatType:m=GPUTextureFormat.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",a)}break;case DepthFormat:switch(a){case UnsignedShortType:m=GPUTextureFormat.Depth16Unorm;break;case UnsignedIntType:m=GPUTextureFormat.Depth24Plus;break;case FloatType:m=GPUTextureFormat.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",a)}break;case DepthStencilFormat:switch(a){case UnsignedInt248Type:m=GPUTextureFormat.Depth24PlusStencil8;break;case FloatType:t&&!1===t.features.has(GPUFeatureName.Depth32FloatStencil8)&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),m=GPUTextureFormat.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",a)}break;case RedIntegerFormat:switch(a){case IntType:m=GPUTextureFormat.R32Sint;break;case UnsignedIntType:m=GPUTextureFormat.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",a)}break;case RGIntegerFormat:switch(a){case IntType:m=GPUTextureFormat.RG32Sint;break;case UnsignedIntType:m=GPUTextureFormat.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",a)}break;case RGBAIntegerFormat:switch(a){case IntType:m=GPUTextureFormat.RGBA32Sint;break;case UnsignedIntType:m=GPUTextureFormat.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",a)}break;default:console.error("WebGPURenderer: Unsupported texture format.",r)}return m}export default WebGPUTextureUtils;
//# sourceMappingURL=WebGPUTextureUtils.js.map